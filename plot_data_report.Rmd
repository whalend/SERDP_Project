---
title: "Fire-Plant Invasions-TBD"
output:
  html_document:
    self_contained: no
    toc: true
    toc_float: true
  pdf_document:
    toc: yes
date: "`r Sys.Date()`"
---

```{r set options, echo=F}
# knitr::opts_chunk$set(fig.height = 10)
knitr::opts_chunk$set(fig.width = 7.5, fig.height = 7.5)
knitr::opts_chunk$set(dpi = 300)
knitr::opts_chunk$set(echo = F)
knitr::opts_chunk$set(warning = F)
knitr::opts_chunk$set(message = F)
```

```{r load libraries, echo=F}
# source(plot-data.R)

library(plyr); library(dplyr); library(ggplot2); library(readr)
library(stringi); library(stringr)
library(tidyr)
library(viridisLite); library(viridis)

rm(list=ls())

```

```{r assign global variables}

# define ggplot theme ####
def_theme <- theme(legend.title = element_blank(),
            legend.text = element_text(size = 12),
            legend.position = "top",
            legend.direction = "vertical",
            axis.text = element_text(size = 14),
            axis.title = element_text(size = 16),
            plot.title = element_text(size = 18),
            strip.background = element_blank(),
            panel.grid = element_blank()
            )

# assign colors ####
invasion_color <- scale_color_manual(values = c("deepskyblue", "red"))
invasion_fill <- scale_fill_manual(values = c("deepskyblue", "red"))

```

```{r read in plot data, echo=F, results='hide'}
# Check source R script if needed: 'plot-data-qaqc.R'
# source("R_scripts/plot-data-qaqc.R")

plot_visit_data <- read_csv("data/processed_data/plot_visit_data.csv")
plot_fri <- read_csv("data/processed_data/fire_return_plots.csv")

plot_visit_data <- left_join(
      select(plot_visit_data, plot_id:last_fire_year, lon, lat, inst_name),
      select(plot_fri, plot_id:frindex),
      by = c("plot_id", "visit_date", "inst_name"="inst_nm")
)
# summary(plot_visit_data)
# sort(unique(plot_visit_data$plot_id))
# filter(plot_visit_data, is.na(years_since_fire))$plot_id

# There should be 104 records, 29 in visit year 2017 and 75 in 2018.
# filter(plot_visit_data, visit_year==2017)
# filter(plot_visit_data, visit_year==2018)

plot_visit_data$imcy_inv <- factor(plot_visit_data$imcy_inv, levels=c("uninvaded","invaded"), labels = c("Uninvaded","Invaded"))

## Exclude NA
plot_visit_data <- plot_visit_data[!is.na(plot_visit_data$n_fires),]
plot_visit_data$visit_year <- lubridate::year(plot_visit_data$visit_date)
# summary(plot_visit_data)


```

~~There are 3 `NA` values in the coarse fire history columns. The `NA`s correspond to the odd/extra cogongrass plot that we sampled at Camp Blanding and 2 plots at Camp Shelby that I (WD) have requested data for as of 9/6/2018.~~

Update 8/5/2019: Using fire history calculated from GIS layers provided by installations we have 103 plot visits with corresponding fire history. There was one NA corresponding to the small cogongrass invasion sampled at Camp Blanding, which should be excluded from most general analyses but may be useful as a data point for cogongrass-specific questions.

# Installations Visited and Plots Sampled

We established **`r n_distinct(plot_visit_data$plot_id)` different plots** at **`r n_distinct(plot_visit_data$inst_name)` DoD installations** and XX total "installations." Some plots were visited multiple times resulting in a total of **`r length(plot_visit_data$plot_id)` plot visits**


```{r make installation map, echo=F, results='hide', eval=F}

library(rgdal); 
library(sp); 
library(maptools); 
library(sf)

plots <- read_sf("data/plot-locations.shp")
installations <- st_read("data/selected_installations.shp")
summary(installations)
# installations$FULLNAME
# bases <- c("Tyndall AFB","Ft. Benning","Camp Blanding","Ft. Jackson","Eglin AFB","Ft. Gordon","Camp Shelby","Avon Park AFR","Moody AFB")
# length(bases)
# installations <- installations[installations$FULLNAME%in%bases,]
# summary(installations)
# plot(installations, col = installations$FULLNAME)

# plot(installations)
# plot(plots, add = T)

library(ggmap)
library(maps)
library(mapdata)
library(tmap)
library(tmaptools)

states <- map_data("state")
southeast <- subset(states, region %in% c("florida", "mississippi", "alabama", "georgia", "south carolina"))

ggplot(data = southeast) + 
      geom_polygon(aes(x = long, y = lat, group = group), fill = "palegreen", color = "black") + 
      coord_fixed(1.3)



vignette("tmap-getstarted")

data("World")

tm_shape(World) +
      tm_polygons("HPI")

tmap_mode("view")
tm_shape(World) +
      tm_polygons("HPI")

data(World, metro, rivers, land)

tmap_mode("plot")
## tmap mode set to plotting

tm_shape(installations) +
      tm_polygons(col = "blue") +
      # tm_borders("white", lwd = .5) +
      tm_text("FULLNAME") 
      # tm_shape(land) +
      # tm_raster("elevation", palette = terrain.colors(10))

tm_shape(metro) +
    tm_symbols(col = "red", size = "pop2020", scale = .5) +
tm_legend(show = FALSE)

tmap_mode("view")
# tm_basemap("Esri.WorldImagery") +
tm_basemap("Esri.WorldGrayCanvas") +
      # tm_shape(southeast) + tm_borders("black", lwd = .5) +
      tm_shape(installations) + 
      tm_polygons(col = "red") +
      tm_text("FULLNAME", col = "black", just = "top", ymod = 1)
      # tm_shape(plots) +
      # tm_symbols(col = "blue", size = .0001)



```


![](figures/installations_visited_map.png)

Due to the low number of cogongrass-invaded plots on DoD installations we identified an additional 28(??) sites across Florida that had cogongrass invasions â‰¥ .1 ha(??) and located at least partially within forested areas. A plot was also established in a nearby uninvaded area at XX of these sites.

```{r summary of plots visited, fig.height=5}

# xtabs(~ imcy_inv + last_fire_year + inst_name, data = plot_visit_data)

# ggplot(plot_data, aes(installation)) +
#       geom_bar() +
#       ylab("Number of plots") +
#       ggtitle("Number of plots established at each installation") +
#       theme_classic()
# plot_data$inv_colors[plot_data$imcy_inv=="invaded"] <- "#d8b365"
# plot_data$inv_colors[plot_data$imcy_inv=="uninvaded"] <- "#5ab4ac"

plot_nums <- plot_visit_data %>%
      group_by(inst_name, imcy_inv) %>% 
      summarise(plot_ct = n_distinct(plot_id))
plot_nums %>%       
      ggplot(aes(inst_name, plot_ct, label=plot_ct)) +
      geom_col(aes(fill = imcy_inv)) +
      invasion_fill +
      geom_text(nudge_y = -.55) +
      # scale_fill_manual(values = c(installation_name = "blue")) +
      # facet_grid(inst_name ~ ., scales = "free_y") +
      ylab("Number of plots sampled") +
      xlab("") +
      # ggtitle("Plots in Burn Units Across Installations") +
      theme_classic() +
      def_theme +
theme(legend.position = c(.88,.95),
            axis.text.x = element_text(angle = 290, vjust = .5, hjust = .1 )) +
      NULL

plot_visit_data %>% 
      filter(!duplicated(plot_id)) %>% 
      group_by(round(y_since_fire), imcy_inv) %>% 
      summarise(plot_ct = n_distinct(plot_id)) %>% 
      ggplot(aes(`round(y_since_fire)`, plot_ct, label = plot_ct)) +
      # geom_count(aes(fill = imcy_inv, color = imcy_inv)) +
      geom_col(aes(fill = imcy_inv), position = "dodge") +
      # geom_text() +
      invasion_fill +
      invasion_color +
      # scale_fill_discrete(h = c(249,200)) +
      ylab("Number of plots") +
      xlab("Years since fire") +
      # ggtitle("Invaded vs. Uninvaded Plots Across Burn Units") +
      theme_classic() +
      def_theme +
      theme(legend.position = c(.8,.9)) +
      NULL

# ggplot(plot_data, aes(imcy_inv)) +
#       geom_bar() +
#       ylab("Number of plots") +
#       xlab("") +
#       ggtitle("Invaded plots: 8, Uninvaded plots: 21") +
#       theme_classic()

# ggplot(plot_visit_data, aes(ycoord_lat, years_since_fire)) +
#       geom_point(aes(color = installation, shape = imcy_inv), size = 2) +
#       # geom_bar(stat = "identity") +
#       theme_classic()

```

**Number of plots in each fire year at each installation.**

```{r fire invasion by installation, fig.height=10}

plot_visit_data %>% 
      ggplot(aes(inst_name, last_fire_year)) +
      geom_count(aes(color = imcy_inv), position = position_dodge(width = .5)) +
      # geom_bar(aes(fill = imcy_inv), position = "dodge") +
      invasion_fill +
      invasion_color +
      # facet_grid(inst_name~.) +
      ylab("Last fire year") +
      xlab("Installation") +
      # ggtitle("Invaded vs. Uninvaded Plots Across Burn Units") +
      theme_bw() +
      def_theme +
      theme(axis.text.x = element_text(angle = 290, vjust = .5, hjust = .1 )) +
      NULL

```


We made ~~104~~ 103 plot visits, excluding the cogongrass plot at Camp Blanding. Therefore, we should have 103 observations for all data summarized to the plot level.

# Canopy Cover Data
```{r load canopy cover data}

canopy_cover <- read_csv("data/processed_data/canopy-cover.csv")
# canopy_cover <- canopy_cover %>% 
#       mutate(date = as.Date(as.character(date), format = "%Y%m%d"),
#              visit_year = lubridate::year(date))

canopy_cover_summary <- canopy_cover %>%
      group_by(installation, plot_id, visit_year) %>%
      summarise(avg_canopy_cover = mean(pct_canopy_cover),
                sd_canopy_cover = sd(pct_canopy_cover),
                n_obs = length(pct_canopy_cover),
                se_canopy_cover = sd_canopy_cover/sqrt(n_obs))
canopy_cover_summary <- left_join(
      select(canopy_cover_summary, -installation),
      plot_visit_data
      
)
# summary(canopy_cover_summary)
canopy_cover_summary <- na.omit(canopy_cover_summary)

# summary(cc_inv)
# cc_inv <- filter(cc_inv, !is.na(years_since_fire))

```


```{r canopy-cover-fire-figure}

ggplot(canopy_cover_summary, aes(log(n_fires), avg_canopy_cover)) +
      geom_point(aes(color = imcy_inv)) +
      # geom_smooth(aes(color = imcy_inv), method = "loess", alpha = .2, linetype = "dashed", se = F) +
      geom_smooth(aes(fill = imcy_inv, color = imcy_inv), method = "lm", alpha = .2) +
      # geom_smooth(method = "lm", linetype = "dashed", color = "gray50") +
      invasion_color +
      invasion_fill +
      # scale_fill_discrete(h = c(249,200)) +
      ylab("Overstory canopy cover (%)") +
      xlab("Number of fires") +
      # ggtitle("Invaded vs. Uninvaded Plots Across Burn Units") +
      theme_classic() +
      def_theme +
      theme(legend.title = element_blank())
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/canopy-cover-fire.png", height = 7.5, width = 7.5)

ggplot(canopy_cover_summary, aes(log(fri15yr), avg_canopy_cover)) +
      geom_point(aes(color = imcy_inv)) +
      geom_smooth(aes(fill = imcy_inv, color = imcy_inv), method = "lm", alpha = .2) +
      invasion_color +
      invasion_fill +
      ylab("Overstory canopy cover (%)") +
      xlab("15-year FRI (log)") +
      # ggtitle("Invaded vs. Uninvaded Plots Across Burn Units") +
      theme_classic() +
      def_theme +
      theme(legend.title = element_blank())

ggplot(canopy_cover_summary, aes(log(frindex), avg_canopy_cover)) +
      geom_point(aes(color = imcy_inv)) +
      geom_smooth(aes(fill = imcy_inv, color = imcy_inv), method = "lm", alpha = .2) +
      invasion_color +
      invasion_fill +
      ylab("Overstory canopy cover (%)") +
      xlab("15-year fire return index (log)") +
      # ggtitle("Invaded vs. Uninvaded Plots Across Burn Units") +
      theme_classic() +
      def_theme +
      theme(legend.title = element_blank()) +
      # annotate(geom = "rect", xmin = -1.4, xmax = 1.4, ymin = -1, ymax = 1, fill = "white") +
      annotate(geom = "text", x = 0, y = 0, label = "More frequently & recently burned") +
      NULL

```

```{r canopy-cover-vs-fire-models}

cc_fire_mod1 <- lm(avg_canopy_cover ~ log(n_fires) + imcy_inv, data = canopy_cover_summary)
summary(cc_fire_mod1)

cc_fire_mod2 <- lm(avg_canopy_cover ~ log(fri15yr) + imcy_inv, data = canopy_cover_summary)
summary(cc_fire_mod2)

cc_fire_mod3 <- lm(avg_canopy_cover ~ log(frindex) + imcy_inv, data = canopy_cover_summary)
summary(cc_fire_mod3)

AIC(cc_fire_mod1, cc_fire_mod2, cc_fire_mod3)

```



# Species Data - 1-meter Quadrats

```{r load 1m quadrat data}

quadrat_data <- read_csv("data/processed_data/quadrat1m.csv")
# summary(quadrat_data)
# quadrat_data$date <- as.Date(as.character(quadrat_data$date), format = "%Y%m%d")
# quadrat_data <- quadrat_data %>% 
      # mutate(visit_year = lubridate::year(date))
# filter(quadrat_data, is.na(years_since_fire))

quadrat_data <- left_join(
      select(quadrat_data, -notes),
      plot_visit_data
)

# Filter to only data collected at 10m quadrats - exclude "extra" data from 2017
quadrat10_data <- filter(
      quadrat_data, quadrat_id %in% c("e10","w10","n10","s10")
)

# summary(quadrat10_data)

```

```{r summarize 1m quadrat data across each plot}

quadrat10_summaries <- quadrat10_data %>%
      group_by(plot_id, visit_year, inst_name) %>%
      summarise(
            avg_woody_ht1 = mean(woody_veg_ht1),
            avg_woody_ht_all = mean(
                  c(woody_veg_ht1,woody_veg_ht2,woody_veg_ht3), na.rm = T),
            avg_herb_ht1 = mean(herb_veg_ht1),
            avg_herb_ht_all = mean(c(herb_veg_ht1, herb_veg_ht2, herb_veg_ht3), na.rm = T),
            avg_litter_depth1 = mean(litter_ht1),
            avg_litter_depth_all =
                  mean(c(litter_ht1,litter_ht2,litter_ht3), na.rm = T),
            avg_pct_green = mean(pct_green),
            avg_pct_litter = mean(pct_litter),
            avg_pct_wood = mean(pct_wood_litter),
            avg_pct_bare = mean(pct_bare))
# skimr::skim(quadrat10_summaries)

quadrat10_summaries <- left_join(
      plot_visit_data,
      quadrat10_summaries
)

summary(quadrat10_summaries)

```

```{r herbaceous height fig}

ggplot(quadrat10_summaries, 
                      aes(log(y_since_fire), avg_herb_ht_all)) +
      geom_point(aes(color = imcy_inv), size = 2) +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "lm", alpha = .2) +
      invasion_color +
      invasion_fill +
      theme_classic() +
      def_theme +
      ylab("Herbaceous plant height (cm)") +
      xlab("Years since fire (log)") +
      # ggtitle("Height of herbaceous species") +
      theme(legend.position = c(.85,.9)) +
      NULL

(herb_ht_fig <- ggplot(quadrat10_summaries, 
                      aes(log(fri15yr), avg_herb_ht_all)) +
      geom_point(aes(color = imcy_inv), size = 2) +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "lm", alpha = .2) +
      invasion_color +
      invasion_fill +
      theme_classic() +
      def_theme +
      ylab("Herbaceous plant height (cm)") +
      xlab("Number of years (log 15-year FRI)") +
      # ggtitle("Height of herbaceous species") +
      theme(legend.position = c(.85,.9)) +
      NULL
)

ggplot(quadrat10_summaries, 
                      aes(log(frindex), avg_herb_ht_all)) +
      geom_point(aes(color = imcy_inv), size = 2) +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "lm", alpha = .2) +
      invasion_color +
      invasion_fill +
      theme_classic() +
      def_theme +
      ylab("Herbaceous plant height (cm)") +
      xlab("15-year fire return index (log)") +
      # ggtitle("Height of herbaceous species") +
      theme(legend.position = c(.85,.9)) +
      NULL

```

```{r woody height fig}
      
(woody_ht_fig <- ggplot(quadrat10_summaries, aes(log(y_since_fire), avg_woody_ht_all)) +
      geom_point(aes(color = imcy_inv), size = 2) +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "lm", alpha = .2) +
      invasion_color +
      invasion_fill +
      theme_classic() +
      def_theme +
      ylab("Woody plant height (cm)") +
      xlab("Years since fire (log)") +
      # ggtitle("Height of woody species") +
      theme(legend.position = c(.85,.9)) +
      NULL
)

```

```{r litter depth fig}

(litter_depth_fig <- ggplot(quadrat10_summaries, 
                            aes(log(y_since_fire), avg_litter_depth_all)) +
      geom_point(aes(color = imcy_inv), size = 2) +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "lm", alpha = .2) +
      # stat_summary(aes(color = imcy_inv), fun.data = "mean_se", geom = "pointrange") +
      invasion_color +
      invasion_fill +
      theme_classic() +
      def_theme +
      xlab("Years since fire (log)") +
      ylab("Litter depth (cm)") +
      theme(legend.position = c(.85,.9)) +
      NULL
)

ggplot(quadrat10_summaries, aes(log(fri15yr), avg_litter_depth_all)) +
      geom_point(aes(color = imcy_inv), size = 2) +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "lm", alpha = .2) +
      # stat_summary(aes(color = imcy_inv), fun.data = "mean_se", geom = "pointrange") +
      invasion_color +
      invasion_fill +
      theme_classic() +
      def_theme +
      xlab("Years (log 15-year FRI)") +
      ylab("Litter depth (cm)") +
      theme(legend.position = c(.85,.9)) +
      NULL

ggplot(quadrat10_summaries, aes(log(frindex), avg_litter_depth_all)) +
      geom_point(aes(color = imcy_inv), size = 2) +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "lm", alpha = .2) +
      # stat_summary(aes(color = imcy_inv), fun.data = "mean_se", geom = "pointrange") +
      invasion_color +
      invasion_fill +
      theme_classic() +
      def_theme +
      xlab("15-year fire return index (log)") +
      ylab("Litter depth (cm)") +
      theme(legend.position = c(.85,.9)) +
      NULL

```

```{r pct-litter-fire}

(pct_litter_fig <- ggplot(quadrat10_summaries, aes(log(y_since_fire), avg_pct_litter)) +
      geom_point(aes(color = imcy_inv), size = 2) +
      # stat_summary(aes(color = imcy_inv), fun.data = "mean_se", geom = "pointrange") +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "lm", alpha = .2) +
      invasion_color +
      invasion_fill +
      theme_classic() +
      def_theme +
      xlab("Years since fire (log)") +
      ylab("Litter cover (%)") +
      # theme(legend.position = c(.85,.1)) +
      NULL
)

ggplot(quadrat10_summaries, aes(log(fri15yr), avg_pct_litter)) +
      geom_point(aes(color = imcy_inv), size = 2) +
      # stat_summary(aes(color = imcy_inv), fun.data = "mean_se", geom = "pointrange") +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "lm", alpha = .2) +
      invasion_color +
      invasion_fill +
      theme_classic() +
      def_theme +
      xlab("Years (log 15-year FRI)") +
      ylab("Litter cover (%)") +
      # theme(legend.position = c(.85,.1)) +
      NULL

ggplot(quadrat10_summaries, aes(log(frindex), avg_pct_litter)) +
      geom_point(aes(color = imcy_inv), size = 2) +
      # stat_summary(aes(color = imcy_inv), fun.data = "mean_se", geom = "pointrange") +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "lm", alpha = .2) +
      invasion_color +
      invasion_fill +
      theme_classic() +
      def_theme +
      xlab("15-year fire return index (log)") +
      ylab("Litter cover (%)") +
      # theme(legend.position = c(.85,.1)) +
      NULL

```

```{r pct-litter-fire-model}

pct_lit_fire_mod1 <- lm(avg_pct_litter ~ log(y_since_fire) + imcy_inv, data = quadrat10_summaries)
summary(pct_lit_fire_mod1)

pct_lit_fire_mod2 <- lm(avg_pct_litter ~ log(fri15yr) + imcy_inv, data = quadrat10_summaries)
summary(pct_lit_fire_mod2)

pct_lit_fire_mod3 <- lm(avg_pct_litter ~ log(frindex) + imcy_inv, data = quadrat10_summaries)
summary(pct_lit_fire_mod3)

AIC(pct_lit_fire_mod1, pct_lit_fire_mod2, pct_lit_fire_mod3)

```


```{r pct-bare-fire-fig}

(pct_bare_fig <- ggplot(quadrat10_summaries, aes((y_since_fire), avg_pct_bare)) +
      geom_point(aes(color = imcy_inv), size = 2) +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "loess", se = T, alpha = .2) +
      invasion_color +
      invasion_fill +
      theme_classic() +
      def_theme +
      xlab("Years since fire") +
      ylab("Bare ground (%)") +
      # theme(legend.position = c(.85,.9)) +
      NULL
)

ggplot(quadrat10_summaries, aes(log(frindex), avg_pct_bare)) +
      geom_point(aes(color = imcy_inv), size = 2) +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "loess", se = T, alpha = .2) +
      invasion_color +
      invasion_fill +
      theme_classic() +
      def_theme +
      xlab("15-year fire return index (log)") +
      ylab("Bare ground (%)") +
      # theme(legend.position = c(.85,.9)) +
      NULL

```


## Understory vegetation cover

```{r load species data}

species_data_import <- read_csv("data/processed_data/species1m.csv")
# summary(species_data)
# nrow(filter(species_data, is.na(functional_group)))
# nrow(filter(species_data, is.na(functional_group__1)))

species_data <- left_join(
      select(species_data_import, installation:visit_year),
      plot_visit_data
)

# names(species_data)
# unique(species_data$veg_id)
# sort(unique(species_data$scientific_name))

# str(species_data)

# summary(species_data)

# filter(species_data, scientific_name == "NA NA")$functional_group


species_data$functional_group <- tolower(species_data$functional_group)
# is.na(unique(species_data$functional_group))
# filter(species_data, is.na(functional_group))

species10_data <- species_data %>% 
      filter(quadrat_id %in% c("e10","w10","n10","s10"))

```

```{r summarize species veg cover}

veg_cover_data <- species10_data %>% 
      arrange(date) %>% 
      mutate(fx_group = case_when(
            functional_group=="algae" ~ "moss/lichen",
            functional_group=="moss" ~ "moss/lichen",
            functional_group=="lichen" ~ "moss/lichen",
            functional_group=="forb/shrub" ~ "forb",
            functional_group=="shrub/tree" ~ "shrub",
            TRUE ~ functional_group
            )) %>% 
      filter(!is.na(functional_group)) %>% 
      group_by(inst_name, plot_id, visit_year, fx_group) %>% 
      summarise(
            total_pct_cover = sum(pct_cover),
            avg_pct_cover = mean(pct_cover)
      )
veg_cover_data <- left_join(
      plot_visit_data,
      veg_cover_data
)
# summary(veg_cover_data)
# filter(veg_cover_data, is.na(imcy_inv))

```

```{r fxgroup fig, eval=T}
## What am I even looking at???


(fxgroup_cover_fig <- ggplot(veg_cover_data, aes(y_since_fire, avg_pct_cover)) +
      geom_point(aes(color = fx_group, shape = imcy_inv)) +
      scale_color_viridis_d() +
      scale_shape_manual(values = c(0, 19)) +
        
      # stat_summary(fun.data = "mean_se", geom = "pointrange") +
      # geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "lm") +
      # invasion_color +
      # facet_grid(.~imyc_inv) +
      theme_bw() +
      def_theme +
      theme(legend.position = "top")
)

# filter(veg_cover_data, functional_group=="algae")$plot_id
## avonpark g1

```

```{r average species cover}

# datac$se <- datac$sd / sqrt(datac$N)
# species_data$imcy_inv <- factor(species_data$imcy_inv, levels = c("uninvaded","invaded"))

## Create data frame of vegetation cover averaged across plots, burn units, and installations
# avg_species_cover <- species10_data %>%
#              group_by(inst_name, visit_year, plot_id, imcy_inv, years_since_fire, quadrat_id) %>%
#       summarise(veg_cover = sum(pct_cover, na.rm = T)) %>% 
#       ungroup(.) %>% 
#       group_by(inst_name, imcy_inv, years_since_fire, plot_id) %>%
#              summarise(avg_veg_cover = mean(veg_cover, na.rm = T),
#                        # n_obs = length(veg_id),
#                        max_veg_cover = max(veg_cover, na.rm = T),
#                        se_veg_cover = sd(veg_cover, na.rm = T)/sqrt(length(veg_cover)))
# summary(avg_species_cover)
# avg_species_cover <- filter(avg_species_cover, is.na(years_since_fire))

## Quadrat-level figure ####
### data
veg_cover_quadrats <- species10_data %>%
      filter(plot_id != "blanding theater_cogon") %>% 
      # filter(quadrat_id %in% c("w10","e10","n10","s10")) %>%
      group_by(inst_name, visit_year, plot_id, imcy_inv, quadrat_id) %>%
      summarise(quadrat_veg_cover = sum(pct_cover, na.rm = T)) %>% 
      ungroup(.)
## Two plots that we don't have fire data for

veg_cover_quadrats <- left_join(
      veg_cover_quadrats,
      plot_visit_data
)

### figure
ggplot(veg_cover_quadrats, aes(y_since_fire, quadrat_veg_cover)) +
      geom_point(aes(color = imcy_inv), size = 2, position=position_jitter(width = .2), alpha = .6) +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "loess", alpha = .2) +
      invasion_color +
      invasion_fill +
      theme_classic() +
      def_theme +
      theme(legend.position = c(.85,.9)) +
      NULL

## Plot-level figure ####
### data
veg_cover_plot_data <- species10_data %>%
      filter(plot_id != "blanding theater_cogon") %>% 
      group_by(inst_name, visit_year, plot_id, imcy_inv, quadrat_id) %>%
      summarise(veg_cover = sum(pct_cover, na.rm = T)) %>% 
      ungroup(.) %>% 
      group_by(plot_id, visit_year, imcy_inv, inst_name) %>% 
      summarise(
            plot_avg_veg_cover = mean(veg_cover, na.rm = T),
            n_obs = length(veg_cover),
            max_veg_cover = max(veg_cover, na.rm = T),
            sd_veg_cover = sd(veg_cover, na.rm = T),
            se_veg_cover = sd_veg_cover / sqrt(n_obs)) %>% 
      ungroup(.)

veg_cover_plot_data <- left_join(
      veg_cover_plot_data,
      plot_visit_data
)

### figure
(veg_cover_fig <- ggplot(veg_cover_plot_data,
      aes(y_since_fire, plot_avg_veg_cover)) +
      # geom_bar(aes(fill = imcy_inv), stat = "identity", position = "dodge") +
      # geom_errorbar(aes(ymin = plot_avg_veg_cover + se_veg_cover, ymax = plot_avg_veg_cover - se_veg_cover), width = 0, position=position_dodge(width = .9)) +
      geom_point(aes(color = imcy_inv), size = 2, position = position_jitter(width = .15), alpha = .6) +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "loess", alpha = .2) +
      invasion_fill +
      invasion_color +
      # facet_grid(inst_name~.) +
      theme_classic() +
      ylab("Vegetation cover (%)") +
      xlab("Years since fire") +
      ggtitle("Plot averages for herbaceous vegetation cover") +
      def_theme +
      theme(legend.position = c(.8,.9)) +
      NULL
)

# ggsave("~/Dropbox (UF)/SERDP-Project/figures/avg-pct-cover-bars.png", height = 9)

```


## Understory species richness
```{r species richness data}

species_richness <- species10_data %>%
      filter(plot_id != "blanding theater_cogon") %>% 
      group_by(inst_name, imcy_inv, visit_year, plot_id) %>%
      summarise(richness = n_distinct(scientific_name)) %>% 
      mutate(ln_richness = log(richness),
             max_richness = max(richness))
species_richness <- left_join(
      plot_visit_data,
      species_richness
)

invaded_quadrats <- species10_data %>% 
      filter(scientific_name=="Imperata cylindrica") %>% 
      mutate(quadrat_invaded = "yes") %>% 
      select(plot_id:quadrat_id, quadrat_invaded, inst_name, visit_year)
invaded_quadrats <- left_join(
      invaded_quadrats,
      plot_visit_data
)

species10_data <- left_join(species10_data, invaded_quadrats)
species10_data$quadrat_invaded[is.na(species10_data$quadrat_invaded)] <- "no"
# summary(species10_data)

quadrat_species_richness <- species10_data %>%
      group_by(inst_name, plot_id, quadrat_invaded, quadrat_id, visit_year) %>%
      summarise(richness = n_distinct(scientific_name)) %>% 
      mutate(ln_richness = log(richness),
             max_richness = max(richness),
             invasion_status = factor(quadrat_invaded, levels = c("no","yes"), labels = c("Uninvaded","Invaded")))

# quadrat10_richness <- quadrat_species_richness %>% 
#       filter(quadrat_id %in% c("e10","n10","s10","w10"))

```

There were `r length(invaded_quadrats$quadrat_invaded)` (`r round(100*length(invaded_quadrats$quadrat_invaded)/length(quadrat_species_richness$richness), digits = 1)` %) 1-m quadrats located in invaded areas representing `r n_distinct(invaded_quadrats$last_fire_year)` different years since fire at `r n_distinct(invaded_quadrats$inst_name)` different installations (`r unique(invaded_quadrats$inst_name)`).

```{r quadrat richness figure, eval = F}

## All points
# ggplot(quadrat_species_richness, aes(years_since_fire, richness, color = invasion_status)) +
#       # geom_boxplot(notch = F) +
#       geom_point(position = "jitter") +
#       invasion_color +
#       invasion_fill +
#       geom_smooth(show.legend = F, alpha = .2, aes(fill = invasion_status)) +
#       # facet_grid(.~installation) +
#       theme_classic() +
#       xlab("") +
#       ylab("Richness") +
#       ggtitle("Quadrat-level species diversity")


(quadrat_richness_fig <- ggplot(quadrat_species_richness, aes(years_since_fire, richness, color = invasion_status)) +
      # geom_boxplot(aes(fill = quadrat_invaded), position = "dodge") +
      geom_point(aes(color = invasion_status), alpha = .6, size = 2, position = position_jitter(width = .15)) +
      geom_smooth(show.legend = F, alpha = .2, aes(fill = invasion_status), method = "lm") +
      # stat_summary(fun.y = "mean", geom = "point") +
      # stat_summary(fun.data = "mean_se", geom = "pointrange", position = position_dodge(width = .5)) +
      # facet_grid(inst_name~.) +
      invasion_color +
      invasion_fill +
      theme_classic() +
      # theme_bw() +
      def_theme +
      ylab("Richness") +
      xlab("Years since fire") +
      ggtitle("1m quadrat understory species diversity") +
      theme(
       # strip.background = element_blank(),
            legend.background = element_rect(color="black"),
            legend.position = c(.88,.85),
            ) +
      NULL
)

```

Species richness was highly variable, though tended to be highest during the first year following fire.

```{r plot richness fig}

(plot_richness_fig <- ggplot(species_richness, 
                             aes(log(y_since_fire), richness, color = imcy_inv)) +
      # geom_boxplot(aes(fill = quadrat_invaded), position = "dodge") +
      geom_smooth(show.legend = F, alpha = .2, aes(fill = imcy_inv), method = "lm") +
      geom_point(aes(color = imcy_inv), size = 2, position = position_jitter(width = .15)) +
      # stat_summary(fun.y = "mean", geom = "point") +
      # stat_summary(fun.data = "mean_se", geom = "pointrange", alpha = .7) +
      invasion_color +
      invasion_fill +
      theme_classic() +
      def_theme +
      ylab("Richness") +
      xlab("Years since fire (log)") +
      ggtitle("Understory species diversity in each plot") +
      theme(legend.position = c(.85,.85),
            legend.background = element_rect(color = "black"))
)

ggplot(species_richness, 
       aes(log(fri15yr), richness, color = imcy_inv)) +
      geom_smooth(show.legend = F, alpha = .2, aes(fill = imcy_inv), method = "lm") +
      geom_point(aes(color = imcy_inv), size = 2, position = position_jitter(width = .15)) +
      invasion_color +
      invasion_fill +
      theme_classic() +
      def_theme +
      ylab("Richness") +
      xlab("Years (log 15-year fire return interval)") +
      ggtitle("Understory species diversity in each plot") +
      theme(legend.position = c(.85,.85),
            legend.background = element_rect(color = "black")) +
      NULL

ggplot(species_richness, 
       aes(log(frindex), richness, color = imcy_inv)) +
      geom_smooth(show.legend = F, alpha = .2, aes(fill = imcy_inv), method = "lm") +
      geom_point(aes(color = imcy_inv), size = 2, position = position_jitter(width = .15)) +
      invasion_color +
      invasion_fill +
      theme_classic() +
      def_theme +
      ylab("Richness") +
      xlab("15-year fire return index (log)") +
      ggtitle("Understory species diversity in each plot") +
      theme(legend.position = c(.85,.85),
            legend.background = element_rect(color = "black")) +
      NULL

```

```{r fx groups fig}

### data
plot_fxgroups <- species_data %>% 
      filter(functional_group %in% c("graminoid","forb","tree","shrub"),
             plot_id != "blanding theater_cogon") %>% 
      filter(quadrat_id %in% c("e10","n10","s10","w10")) %>% 
      group_by(visit_year, imcy_inv, plot_id, functional_group) %>% 
      summarise(fxgroup_abundance = n_distinct(scientific_name))

plot_fxgroups <- left_join(
      plot_fxgroups,
      plot_visit_data
)

### figure
ggplot(plot_fxgroups, 
       aes(y_since_fire, fxgroup_abundance, color = functional_group)) +
      geom_point() +
      # stat_summary(fun.data = "mean_se", geom = "pointrange") +
      geom_smooth(alpha = .2, se=F, method = "lm", show.legend = F) +
      # invasion_color +
      scale_color_viridis_d() +
      theme_classic() +
      xlab("Years since fire") +
      ylab("Abundance") +
      # ggtitle("Functional group diversity") +
      NULL

```


```{r 5pct species cover, eval=F}

species_over_5pct <- filter(species_data, pct_cover>5)
# species_sub_over_5pct <- filter(species_sub_over_5pct, cogongrass != "NA")
summary(species_over_5pct)
species_over_5pct <- filter(species_over_5pct, !is.na(years_since_fire))

ggplot(species_over_5pct,
       aes(years_since_fire, pct_cover, color = scientific_name)) +
      geom_point() +
      # theme_classic() +
      theme_bw() +
      def_theme +
      scale_fill_viridis_c() +
      facet_grid(inst_name~imcy_inv) +
      ylab("% cover") +
      xlab("Years since fire") +
      ggtitle("Range of species cover (>5%) at 1-meter quadrats")
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/species-pct-cover.png", height = 7.5, width = 7.5)

```


# Biomass data sampled at 25cm quadrats

Biomass is averaged across the four 25 cm quadrats for each plot, and then these values are summarized in the figures across the roughly estimated years since fire. 

```{r 25cm biomass data, results='hide'}

biomass_data_import <- read_csv("data/processed_data/quadrat25cm.csv")
# biomass_data_import$date <- as.Date(as.character(biomass_data_import$date), format="%Y%m%d")
# summary(biomass_data_import)
# filter(biomass_data_import, is.na(standing_fuel_mass_dry))$plot_id

biomass_data <- biomass_data_import %>% 
      mutate(pct_litter_moisture = 100*(litter_mass_wet-litter_mass_dry)/litter_mass_wet)
# summary(biomass_data)
# (biomass_data %>% filter(pct_litter_moisture<0) %>%
            # select(litter_mass_wet, litter_mass_dry, plot_id, date))
biomass_data <- biomass_data %>% 
      mutate(pct_litter_moisture = ifelse(pct_litter_moisture<0,0,pct_litter_moisture))

filter(biomass_data, is.na(standing_fuel_mass_dry))$plot_id

biomass_data <- left_join(
      biomass_data,
      plot_visit_data)
summary(biomass_data)

# filter(biomass_data, is.na(y_since_fire))$plot_id

# biomass_data$last_fire_year <- as.integer(biomass_data$last_fire_year)
# biomass_data$years_since_fire <- 2017 - biomass_data$last_fire_year

biomass_plot_summary <- biomass_data %>% 
      filter(plot_id != "blanding theater_cogon") %>% 
      group_by(plot_id, visit_year, imcy_inv, inst_name) %>% 
      mutate(standing_gm2 = standing_fuel_mass_wet*16,
             litter_gm2 = litter_mass_wet*16,
             dry_standing_gm2 = standing_fuel_mass_dry*16,
             dry_litter_gm2 = litter_mass_dry*16) %>% 
      summarise(avg_dry_standing_gm2 = mean(dry_standing_gm2),
                se_dry_standing_gm2 = sd(dry_standing_gm2)/sqrt(length(dry_standing_gm2)),
                avg_wet_standing_gm2 = mean(standing_gm2, na.rm = T),
                avg_dry_litter_gm2 = mean(dry_litter_gm2),
                se_litter = sd(dry_litter_gm2)/sqrt(length(dry_litter_gm2)),
                avg_pct_litter_moisture = mean(pct_litter_moisture))
summary(biomass_plot_summary)

# biomass_plot_summary <- filter(biomass_plot_summary, !is.na(years_since_fire))
# filter(biomass_plot_summary, is.na(avg_dry_standing_gm2))$plot_id

biomass_plot_summary <- left_join(
      biomass_plot_summary,
      plot_visit_data
)

```

```{r standing biomass fig}

(stand_biomass_fig <- ggplot(biomass_plot_summary,
       aes(log(y_since_fire), avg_dry_standing_gm2, color = imcy_inv)) +
      geom_point() +
      # stat_summary(fun.data = "mean_se", geom = "pointrange") +
      geom_smooth(aes(fill = imcy_inv), alpha = .2, method = "lm", show.legend = F) +
      invasion_color +
      invasion_fill +
      # facet_grid(.~installation) +
      # geom_smooth(aes(fill = imcy_inv), se = T, alpha = .1) +
      theme_classic() +
      ylab(expression(paste("Standing biomass (g ", m^{-2}, ")"))) +
      xlab("Years since last fire (log)") +
      ggtitle("Dry standing biomass",
              subtitle = "(measurements at 25cm quadrats)") +
      def_theme +
      theme(legend.title = element_blank(),
            legend.position = c(.85,.85),
            legend.background = element_rect(color = "black")) +
      NULL
)

ggplot(biomass_plot_summary,
       aes(imcy_inv, avg_dry_standing_gm2, color = imcy_inv)) +
      geom_boxplot(show.legend = F, outlier.shape = 1, notch = FALSE) +
      geom_point(position = position_jitter(width = .15)) +
      invasion_color +
      invasion_fill +
      theme_bw() +
      def_theme +
      theme(legend.title = element_blank(),
            legend.position = "none") +
      NULL
      
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/standing-biomass.png", height=7.5, width = 7.5)

```

```{r litter biomass fig}

(litter_mass_fig <- ggplot(biomass_plot_summary,
        aes((y_since_fire), avg_dry_litter_gm2, color = imcy_inv)) +  
      geom_point() +
      geom_smooth(aes(fill = imcy_inv), alpha = .2, method = "loess", linetype = "dashed", se = F) +
      geom_smooth(aes(fill = imcy_inv), alpha = .2, method = "lm", show.legend = F) +
      # stat_summary(fun.data = "mean_se", geom = "pointrange") +
      invasion_color +
      invasion_fill +
      # geom_smooth(aes(fill = imcy_inv), se = T, alpha = .2) +
      # facet_grid(.~installation) +
      theme_classic() +
      ylab(expression(paste("Litter biomass (g ", m^{-2}, ")"))) +
      xlab("Years since last fire (log)") +
      # ggtitle("Dry litter biomass",
              # subtitle = "(measurements at 25cm quadrats)") +
      def_theme +
      theme(legend.position = c(.88,.88),
            legend.background = element_rect(color = "black")) +
       NULL
)

# ggsave("~/Dropbox (UF)/SERDP-Project/figures/litter-biomass.png", height = 7.5, width = 7.5)
ggplot(biomass_plot_summary,
        aes((fri15yr), avg_dry_litter_gm2, color = imcy_inv)) +  
      geom_point() +
      geom_smooth(aes(fill = imcy_inv), alpha = .2, method = "loess", linetype = "dashed", se = F) +
      geom_smooth(aes(fill = imcy_inv), alpha = .2, method = "lm", show.legend = F) +
      # stat_summary(fun.data = "mean_se", geom = "pointrange") +
      invasion_color +
      invasion_fill +
      # geom_smooth(aes(fill = imcy_inv), se = T, alpha = .2) +
      # facet_grid(.~installation) +
      theme_classic() +
      ylab(expression(paste("Litter biomass (g ", m^{-2}, ")"))) +
      xlab("Years (15-year fire return interval)") +
      def_theme +
      theme(legend.position = c(.88,.88),
            legend.background = element_rect(color = "black")) +
       NULL

ggplot(biomass_plot_summary,
        aes((frindex), avg_dry_litter_gm2, color = imcy_inv)) +  
      geom_point() +
      geom_smooth(aes(fill = imcy_inv), alpha = .2, method = "loess", linetype = "dashed", se = F) +
      geom_smooth(aes(fill = imcy_inv), alpha = .2, method = "lm", show.legend = F) +
      # stat_summary(fun.data = "mean_se", geom = "pointrange") +
      invasion_color +
      invasion_fill +
      # geom_smooth(aes(fill = imcy_inv), se = T, alpha = .2) +
      # facet_grid(.~installation) +
      theme_classic() +
      ylab(expression(paste("Litter biomass (g ", m^{-2}, ")"))) +
      xlab("15-year fire return index (log)") +
      def_theme +
      theme(legend.position = c(.88,.88),
            legend.background = element_rect(color = "black")) +
       NULL

```

```{r litter biomass vs fire model}

litter_mass_model1 <- lm(avg_dry_litter_gm2 ~ y_since_fire + imcy_inv, data = biomass_plot_summary)
summary(litter_mass_model1)

litter_mass_model1a <- lm(avg_dry_litter_gm2 ~ log(y_since_fire) + imcy_inv, data = biomass_plot_summary)
summary(litter_mass_model1a)

litter_mass_model2 <- lm(avg_dry_litter_gm2 ~ log(fri15yr) + imcy_inv, data = biomass_plot_summary)
summary(litter_mass_model2)

litter_mass_model3 <- lm(avg_dry_litter_gm2 ~ log(frindex) + imcy_inv, data = biomass_plot_summary)
summary(litter_mass_model3)

AIC(litter_mass_model1a, litter_mass_model2, litter_mass_model3)

```


# Tree Data

```{r load tree data, results='hide'}

tree_data_import <- read_csv("data/processed_data/trees.csv")
# tree_data
# summary(tree_data_import)

tree_data <- tree_data_import %>% 
      select(plot_id, visit_year, species:canopy, height, char, Genus, scientific_name)
      
# unique(tree_data$plot_id)

tree_data <- left_join(
      tree_data,
      plot_visit_data
      )

# sort(unique(tree_data$tree_id))
tree_data$species <- tolower(tree_data$species)

tree_data <- tree_data %>% 
      mutate(
            labels = case_when(
                  Genus == "Quercus" ~ "Quercus",
                  Genus == "Pinus" ~ "Pinus",
                  TRUE ~ "Other"
            )
      )

# summary(tree_data)
# filter(tree_data, is.na(y_since_fire))$plot_id
# skimr::skim(tree_data)

tree_grp_summary <- tree_data %>% 
      filter(health!=0, plot_id != "blanding theater_cogon") %>% 
      group_by(plot_id, labels, y_since_fire, imcy_inv, visit_year) %>% 
      summarise(
            total_dbh_cm = sum(dbh, na.rm = T),
            avg_dbh_cm = mean(dbh, na.rm = T),
            n_stems = length(species))
# summary(tree_grp_summary)
# filter(tree_grp_summary, is.na(avg_dbh_cm))$plot_id

dbh_by_tree_grp <- tree_grp_summary %>% 
      select(-avg_dbh_cm, -n_stems) %>% 
      spread(labels, total_dbh_cm) %>% 
      mutate(Quercus = if_else(is.na(Quercus)==TRUE,0,Quercus),
                   Pinus = if_else(is.na(Pinus)==TRUE,0,Pinus),
                   Other = if_else(is.na(Other)==TRUE,0,Other),
                   total_dbh = rowSums(cbind(Other,Pinus,Quercus), na.rm = T),
                   pct_pinus_dbh = 100*(Pinus/total_dbh))


tree_data_plot_summary <- tree_data %>% 
      filter(health!=0) %>% 
      group_by(plot_id, imcy_inv, visit_year, inst_name) %>% 
      summarise(
            total_dbh = sum(dbh, na.rm = T),
            richness = n_distinct(species),
            avg_tree_ht = mean(height, na.rm = T),
            avg_char_ht = mean(char, na.rm = T))
# summary(tree_data_plot_summary)

tree_data_plot_summary <- left_join(
      tree_data_plot_summary, 
      select(dbh_by_tree_grp, plot_id:visit_year, pct_pinus_dbh)
      )
tree_data_plot_summary <- left_join(
      tree_data_plot_summary,
      plot_visit_data
)
# summary(tree_data_plot_summary)


# skimr::skim(ungroup(tree_data_plot_summary))

# filter(tree_data_plot_summary, is.na(avg_char_ht), visit_year==2018)$plot_id
# filter(tree_data, plot_id=="benning j1")$char

```

## Tree richness
```{r tree richness figure}

# tree_richness <- tree_data %>% 
#       group_by(inst_name, years_since_fire, imcy_inv, plot_id) %>% 
#       summarise(richness = n_distinct(species)) %>% 
#       filter(!is.na(imcy_inv))

(tree_richness_fig <- ggplot(tree_data_plot_summary, 
       aes(log(y_since_fire), richness, color = imcy_inv)) +
      # stat_summary(fun.data = "mean_se", geom = "pointrange", size = 1) +
      geom_point(position = position_jitter(height = .05), alpha = .8) +
      geom_smooth(aes(fill = imcy_inv), method = "lm", alpha = .2) +
      invasion_color +
      invasion_fill +
      # facet_grid(inst_name~.) +
      theme_classic() +
      def_theme +
      ylab("Richness") +
      xlab("Years since fire (log)") +
      ggtitle("Tree diversity vs. time since fire") +
      NULL
)

# ggsave("~/Dropbox (UF)/SERDP-Project/figures/tree-richness-by-fire.png", height=7.5, width = 7.5)

```

## Tree basal area
```{r tree basal area figure}

# plot_basal_area <- tree_data %>%
#       group_by(inst_name, labels, years_since_fire, plot_id) %>%
#       mutate(basal_area_ha = (pi*((.5*dbh/100)^2))/.05) %>% 
#       summarise(total_basal_area_ha = sum(basal_area_ha))
# 
# basal_area_data <- tree_data %>%
#       group_by(inst_name, labels, years_since_fire) %>%
#       mutate(basal_area_ha = (pi*((.5*dbh/100)^2))/.05) %>% 
#       summarise(total_basal_area_ha = sum(basal_area_ha),
#                 avg_basal_area_ha = mean(basal_area_ha),
#                 se_basal_area_ha = sd(basal_area_ha)/sqrt(length(basal_area_ha)))

(tree_dbh_fig <- ggplot(tree_data_plot_summary, 
       aes(log(y_since_fire), total_dbh, color = imcy_inv)
       ) +
      # stat_summary(fun.data = "mean_se", geom = "pointrange", position = "jitter") +
      geom_point() +
      geom_smooth(aes(fill = imcy_inv), method = "lm", se = T, alpha = .2) +
      # geom_violin(aes(labels, dbh, fill = labels)) +
      # geom_dotplot(aes(labels, dbh, fill = labels),
      #            binaxis = "y",         # which axis to bin along
      #            binwidth = 0.4,       # Minimal difference considered different
      #            stackdir = "center"    # Centered
      #            ) +
      # geom_bar(aes(fill = labels), stat = "identity", position = "dodge") +
      # geom_errorbar(aes(ymin = avg_basal_area_ha + se_basal_area_ha, ymax = avg_basal_area_ha - se_basal_area_ha), width = .2, position = position_dodge(width = .5)) +
      # scale_color_brewer(palette = "Dark2") +
      invasion_color +
      invasion_fill +
      # facet_grid(inst_name~.) +
      theme_classic() +
      # theme_bw() +
      xlab("Years since fire (log)") +
      # ylab(expression(paste("Basal Area (", m^{2}, " ", ha^{-1}, ")"))) +
      ylab("DBH (cm)") +
      ggtitle("Total tree DBH across plots") +
      def_theme +
      NULL
)

# ggsave("~/Dropbox (UF)/SERDP-Project/figures/total-dbh-by-fire.png", height=7)

```

```{r proportion pine dbh figure}

(pct_pine_fig <- ggplot(filter(tree_data_plot_summary, pct_pinus_dbh>=0), 
       aes(y_since_fire, pct_pinus_dbh)
       ) +
      # stat_summary(fun.data = "mean_se", geom = "pointrange", position = "jitter") +
      geom_smooth(method = "loess", se = F, alpha = .2) +
      geom_point(aes(color = imcy_inv)) +
      geom_smooth(data=filter(tree_data_plot_summary, pct_pinus_dbh<60),
                  aes(y_since_fire, pct_pinus_dbh),
                  method = "loess", se = F, linetype="dashed", alpha = .2) +
       geom_smooth(data=filter(tree_data_plot_summary, pct_pinus_dbh>60),
                  aes(y_since_fire, pct_pinus_dbh),
                  method = "loess", se = F, linetype="dotted", alpha = .2) +
      invasion_color +
      invasion_fill +
      # facet_grid(inst_name~.) +
      theme_classic() +
      # theme_bw() +
      xlab("Years since fire") +
      # ylab(expression(paste("Basal Area (", m^{2}, " ", ha^{-1}, ")"))) +
      ylab("Percent pine DBH ") +
      # ggtitle("Total tree DBH across plots") +
      def_theme +
      NULL
)

# ggsave("~/Dropbox (UF)/SERDP-Project/figures/pct-pine-dbh.png", height=7.5, width = 7.5)

```

The dashed line is just for the data where pine makes up *less than* 60% of the total DBH; the dotted line is for the data where pine makes up *more than* 60% of the total DBH. The solid line is the overall mean regression fit.


```{r tree dbh, eval = F}

ggplot(tree_data %>%
             filter(!is.na(years_since_fire)) %>% 
             group_by(inst_name, labels, years_since_fire, imcy_inv),
       aes(as.factor(years_since_fire), dbh, color = labels)) +
      geom_point(position = "jitter") +
      scale_fill_brewer(palette = "Dark2") +
      scale_color_brewer(palette = "Dark2") +
      facet_grid(inst_name~imcy_inv) +
      theme_bw() +
      xlab("Years since fire") +
      ylab("Diameter at breast height") +
      def_theme +
      theme(strip.background = element_blank(),
            panel.grid = element_blank()) +
      NULL
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/tree-dbh-jitter.png", height=7)

```


```{r tree height, eval = F}
# tree_height <- tree_data %>%
#       group_by(inst_name, labels, years_since_fire, imcy_inv) 

ggplot(tree_data %>% 
             filter(!is.na(years_since_fire)),
       aes(years_since_fire, height, color = labels)) +
      # stat_summary(fun.data = "mean_se", geom = "pointrange") +
      geom_point(position = "jitter") +
      scale_color_viridis_d() +
      facet_grid(inst_name~imcy_inv) +
      theme_bw() +
      xlab("Years since fire") +
      ylab("Tree height") +
      def_theme
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/tree-height-jitter.png", height=7)

```

```{r char height figure, eval=F}
# tree_data_plot_summary
ggplot(tree_data_plot_summary,
       aes(imcy_inv, avg_char_ht, fill = imcy_inv)) +
      stat_summary(aes(color = imcy_inv), fun.data = "mean_se", geom = "pointrange", size = 1) +
      geom_point(alpha = .5, size = 2, show.legend = F) +
      # geom_bar(stat = "identity", position = "dodge") +
      invasion_color +
      invasion_fill +
      # facet_grid(inst_name~.) +
      # theme_bw() +
      theme_classic() +
      xlab("") +
      ylab("Char height (m)") +
      def_theme +
      theme(legend.position = "top")

# ggsave("~/Dropbox (UF)/SERDP-Project/figures/char-height.png", height=7.5, width = 7.5)

```


# Sub-plot sapling/shrub data

```{r 100m subplot, results='hide'}

subplot_data_import <- read_csv("data/processed_data/woodysubplot.csv")

# subplot_data <- subplot_data_import %>% 
#       mutate(stems_100m2 = round(if_else(date<"2018-01-01", over_100cm*.599,over_100cm*1)))


# summary(subplot_data)
# filter(subplot_data, is.na(years_since_fire))

subplot_plot_summary <- subplot_data_import %>% 
      group_by(plot_id, visit_year, inst_name) %>% 
      summarise(shrub_sap_rich = n_distinct(veg_id),
                total_stems_100m2 = sum(stems_100m2))

subplot_plot_summary <- left_join(
      subplot_plot_summary,
      plot_visit_data
)
# summary(subplot_plot_summary)

```

```{r subplot figure}

(shrub_saplings_fig <- ggplot(
      filter(na.omit(subplot_plot_summary), total_stems_100m2>=0),
      aes(log(y_since_fire), log1p(total_stems_100m2), color = imcy_inv)) +
      # stat_summary(fun.data = "mean_se", geom = "pointrange") +
      geom_point(aes(color = imcy_inv), size = 2) +
      geom_smooth(aes(fill = imcy_inv), alpha = .2, method = "lm") +
      invasion_color +
      invasion_fill +
      # facet_grid(.~veg_id) +
      theme_classic() +
      def_theme +
      # theme(legend.position = c(.85,.95)) +
      xlab("Years since fire (log)") +
      ylab(expression(paste("ln( Shrb/sapling stem density (100 ", {m}^-2,") )"))) +
      ggtitle("") +
      NULL
)

# ggsave("~/Dropbox (UF)/SERDP-Project/figures/subplot_density.png", height=7.5, width = 7.5)

```


# Host Abundance Estimates

```{r dung data, results='hide'}

dung_data_import <- read_csv("data/processed_data/dung.csv")
# dung_data_import$date <- as.Date(as.character(dung_data_import$date), format="%Y%m%d")
# summary(dung_data_import)
# filter(dung_data_import, is.na(species), dung1m>0 | dung2m>0)
dung_data_import$species[is.na(dung_data_import$species) & dung_data_import$dung1m>0] <- "other"
dung_data_import$species[is.na(dung_data_import$species) & dung_data_import$dung2m>0] <- "other"
# filter(dung_data_import, is.na(dung1m)) %>%
      # select(plot_id)

dung_data <- dung_data_import 
# sort(unique(dung_data$plot_id))
# filter(dung_data, is.na(dung1m))

dung_data <- left_join(
      dung_data,
      plot_visit_data)
summary(dung_data)
filter(dung_data, is.na(dung1m))$plot_id

# dung_data <- rename(dung_data, clusters1m = `1m`, clusters2m = `2m`)
dung_plot_data <- dung_data %>% 
      # filter(species == "deer") %>% 
      group_by(plot_id, visit_year, imcy_inv, species, inst_name) %>% 
      summarise(
            total_clusters1m = sum(dung1m, na.rm = T),
            avg_clusters1m = mean(dung1m, na.rm = T),
            total_clusters2m = sum(rowSums(cbind(dung1m,dung2m), na.rm=T)),
            avg_clusters2m = mean(rowSums(cbind(dung1m,dung2m), na.rm=T))
                )
dung_plot_data <- left_join(
      dung_plot_data,
      plot_visit_data
)
summary(dung_plot_data)

dung_plot_data_summary <- dung_plot_data %>% 
      ungroup(.) %>% 
      group_by(plot_id, visit_year, imcy_inv, inst_name) %>% 
      summarise(total_clusters1m = sum(total_clusters1m, na.rm = TRUE),
                total_clusters2m = sum(total_clusters2m, na.rm = TRUE)) %>% 
      left_join(., plot_visit_data)
summary(dung_plot_data_summary)

# skimr::skim(dung_data_avg)

```

```{r dung species figure}

(dung_species_fig <- ggplot(filter(dung_data, !is.na(dung1m)), 
                            aes(y_since_fire, log1p(dung1m))) +
      # geom_bar(aes(fill = imcy_inv), stat = "identity", position = "dodge") +
      geom_point(aes(color = species), size = 2, position = "jitter") +
      # geom_smooth(aes(color = species), alpha = .2) +
      invasion_fill +
      scale_color_viridis_d() +
      # invasion_color +
      # geom_smooth(aes(linetype = imcy_inv), se = F, alpha = .2) +
      # geom_smooth(aes(fill = imcy_inv), se = F, alpha = .2, method = "lm") +
      theme_classic() +
      ylab("log( # of dung clusters )") +
      xlab("Years since fire") +
      # ylab("Dung clusters") +
      def_theme +
      theme(legend.position = "right") +
      NULL
)

# ggsave("~/Dropbox (UF)/SERDP-Project/figures/dung-species.png", height=7.5, width = 7.5)

ggplot(dung_plot_data,
       aes(log(y_since_fire), log1p(total_clusters1m), color = imcy_inv)) +
      geom_point(size = 2) +
      invasion_fill +
      invasion_color +
      geom_smooth(aes(fill = imcy_inv), se = T, method = "loess", alpha = .2) +
      theme_classic() +
      xlab("Years since fire (log)") +
      ylab("Dung clusters (log)") +
      def_theme +
      # theme(legend.position = c(.8,.9)) +
      NULL

ggplot(dung_plot_data,
       aes(log(fri15yr), log1p(total_clusters1m), color = imcy_inv)) +
      geom_point(size = 2) +
      invasion_fill +
      invasion_color +
      geom_smooth(aes(fill = imcy_inv), se = T, method = "loess", alpha = .2) +
      theme_classic() +
      xlab("Years (log 15-year fire return)") +
      ylab("Dung clusters (log)") +
      def_theme +
      NULL

ggplot(dung_plot_data,
       aes(log(frindex), log1p(total_clusters1m), color = imcy_inv)) +
      geom_point(size = 2) +
      invasion_fill +
      invasion_color +
      geom_smooth(aes(fill = imcy_inv), se = T, method = "loess", alpha = .2) +
      theme_classic() +
      xlab("15-year fire return index") +
      ylab("Dung clusters (log)") +
      def_theme +
      NULL

```

```{r deer dung figure}

(deer_dung_fig <- dung_plot_data %>% filter(species=="deer") %>% 
      ggplot(
      aes(log(y_since_fire), log1p(total_clusters1m), color = imcy_inv)) +
      geom_point(size = 2) +
      # stat_summary(fun.data = "mean_se", geom = "pointrange") +
      # geom_bar(aes(fill = imcy_inv), stat = "identity", position = "dodge") +
      # geom_smooth(se = F) +
      invasion_fill +
      invasion_color +
      # geom_smooth(aes(linetype = imcy_inv), se = F, alpha = .1) +
      geom_smooth(aes(fill = imcy_inv), se = T, method = "lm", alpha = .2) +
      theme_classic() +
      ylab("log( # of deer dung clusters )") +
      xlab("Years since fire (log)") +
      # ylab("Dung clusters") +
      def_theme +
      # theme(legend.position = c(.8,.9)) +
      NULL
)

# ggsave("~/Dropbox (UF)/SERDP-Project/figures/dung-vs-fire.png", height=7.5, width = 7.5)
      
```

```{r model deer dung vs fire}

deer_dung_model1 <- lm(log1p(total_clusters1m) ~ log(y_since_fire) + imcy_inv,
                      data = filter(dung_plot_data, species=="deer"))
summary(deer_dung_model1)
deer_dung_model1a <- MASS::glm.nb(total_clusters1m ~ y_since_fire + imcy_inv,
                      data = filter(dung_plot_data, species=="deer"))
summary(deer_dung_model1a)
deer_dung_model1b <- glm(total_clusters1m ~ y_since_fire + imcy_inv,
                      data = filter(dung_plot_data, species=="deer"),
                      family = poisson)
summary(deer_dung_model1b)

deer_dung_model2 <- lm(log1p(total_clusters1m) ~ log(fri15yr) + imcy_inv,
                      data = filter(dung_plot_data, species=="deer"))
summary(deer_dung_model2)
deer_dung_model2a <- MASS::glm.nb(total_clusters1m ~ fri15yr + imcy_inv,
                      data = filter(dung_plot_data, species=="deer"))
summary(deer_dung_model2a)
deer_dung_model2b <- glm(total_clusters1m ~ fri15yr + imcy_inv,
                      data = filter(dung_plot_data, species=="deer"),
                      family = poisson)
summary(deer_dung_model2b)


deer_dung_model3 <- lm(log1p(total_clusters1m) ~ log(frindex) + imcy_inv,
                      data = filter(dung_plot_data, species=="deer"))
summary(deer_dung_model3)
deer_dung_model3a <- MASS::glm.nb(total_clusters1m ~ frindex + imcy_inv,
                      data = filter(dung_plot_data, species=="deer"))
summary(deer_dung_model3a)
deer_dung_model3b <- glm(total_clusters1m ~ frindex + imcy_inv,
                      data = filter(dung_plot_data, species=="deer"),
                      family = poisson)
summary(deer_dung_model3b)

# sjPlot::plot_model(deer_dung_model3a, type = "pred", show.data = TRUE)
# sjPlot::plot_model(deer_dung_model3a, type = "eff", show.data = TRUE)
# sjPlot::plot_model(deer_dung_model3b, type = "pred", show.data = TRUE)

```


# Tick Abundance

## Tick species

- Lone star ticks, *Amblyomma americanum* abbreviation: Am. am

![](pictures/lone-star-ticks.png)

- Gulf coast ticks *Amblyomma maculatum* abbreviation: Am. mac.

![](pictures/gulf-coast-ticks.png)

- American dog ticks *Dermecentor variablis* abbreviation: De. var

![](pictures/american-dog-ticks.png)

- Brown dog ticks *Rhipicephalus sanguineus* abbreviation: Rh. san

![](pictures/brown-dog-ticks.png)

- Black-legged or deer ticks *Ixodes scapularis* abbreviation: Ix. sc

![](pictures/deer-ticks.png)

```{r tick data QC, results='hide'}

tick_data_import <- read_csv("data/processed_data/ticks.csv")
tick_data_import
str(tick_data_import)
# skimr::skim(tick_data_import)

sort(unique(tick_data_import$plot_id))
sort(unique(tick_data_import$installation))
sort(unique(tick_data_import$species))
unique(tick_data_import$life_stage)
unique(tick_data_import$location)
# plot_visit_data
names(plot_visit_data)
names(tick_data_import)

tick_data <- tick_data_import %>%
      mutate(life_stage = factor(life_stage, 
                                 levels = c("adult","nymph"), 
                                 labels = c("Adult","Nymph"))) %>% 
      rename(tick_count = count)
str(tick_data)
str(plot_visit_data)


tick_data %>%
      filter(location != "extra") %>%
      group_by(plot_id, visit_year) %>%
      summarise(tick_count = sum(tick_count)) %>% 
      ungroup(.) %>% 
      group_by(visit_year) %>% 
      summarise(plot_visits = length(plot_id))

unique(plot_visit_data$plot_id)
unique(tick_data$plot_id)


tick_data <- left_join(
      tick_data,
      select(plot_visit_data, -visit_date)
)
summary(tick_data)

# filter(tick_data, is.na(imcy_inv))$location
# sort(unique(tick_data$plot_id))

# filter(tick_data, is.na(years_since_fire))$plot_id
# filter(tick_data, is.na(imcy_inv))$plot_id

# "extra" ticks at Moody AFB were from an area last burned in 2005
# tick_data$years_since_fire[tick_data$installation=="moody"] <- 2017-2005
# tick_data <- tick_data[is.na(tick_data$years_since_fire)==FALSE,]
# tick_data$inst_name[tick_data$installation=="moody"] <- "Moody AFB"

# tick_data$date <- as.Date(as.character(tick_data$date), format = "%Y%m%d")

## Count larvae bombs as "1"
# tick_data <- tick_data %>% 
#       mutate(tick_count = ifelse(life_stage=="Larval",1,count),
#              tick_count = ifelse(is.na(tick_count),0,tick_count))
# summary(tick_data)
# filter(tick_data, is.na(tick_count))$count

```

```{r summarize-tick-abundance-data, results='hide', eval=FALSE}

# tick_data_life_stage_summary <- tick_data %>% 
#       group_by(plot_id, visit_year, life_stage, years_since_fire, imcy_inv, inst_name, visit_date) %>% 
#       summarise(total_ticks = sum(tick_count, na.rm = T)) %>% 
#       ungroup(.) %>% 
#       select(plot_id, visit_year, total_ticks, everything())


tick_data_plot_summary <- tick_data %>% 
      filter(location != "extra") %>%
      group_by(plot_id, visit_year, inst_name) %>%
      summarise(total_ticks = sum(tick_count)) %>% 
      ungroup(.)

tick_data_plot_summary <- left_join(
      plot_visit_data,
      tick_data_plot_summary
)

summary(tick_data_plot_summary)
filter(tick_data_plot_summary, is.na(total_ticks)) %>% 
      select(plot_id, visit_year) %>% 
      arrange(plot_id)

# filter(tick_data_plot_summary, is.na(imcy_inv))$plot_id

tick_data_plot_summary <- tick_data_plot_summary %>% 
      mutate(total_ticks = case_when(
            is.na(total_ticks)==TRUE ~ 0,
            TRUE ~ total_ticks
      ))
# summary(tick_data_plot_summary)

# plot_data
# tick_data_sum <- left_join(plot_visit_data, tick_data_sum)
# tick_data_sum$total_ticks[is.na(tick_data_sum$total_ticks)] <- 0

# tick_data_plot_summary$plot_id[duplicated(tick_data_plot_summary$plot_id)]
# biomass_plot_summary$plot_id[duplicated(biomass_plot_summary$plot_id)]

tick_data_sum <- left_join(
      tick_data_plot_summary, 
      ungroup(biomass_plot_summary) %>% 
            select(plot_id:avg_pct_litter_moisture)
      )

tick_data_sum <- left_join(
      tick_data_sum,
      select(ungroup(quadrat10_summaries), plot_id, inst_name, visit_year:avg_pct_bare))
# summary(tick_data_sum)

tick_data_sum <- left_join(
      tick_data_sum,
      select(ungroup(veg_cover_plot_data), plot_id:se_veg_cover, -n_obs)
)
# summary(tick_data_sum)

tick_data_sum <- left_join(
      tick_data_sum, 
      ungroup(canopy_cover_summary) %>% 
            select(plot_id:se_canopy_cover, -n_obs))
# summary(tick_data_sum)

tick_data_sum <- left_join(
      tick_data_sum, 
      ungroup(dung_plot_data_summary) %>% 
            select(plot_id:total_clusters2m)
      )
# summary(tick_data_sum)

tick_data_sum <- left_join(
      tick_data_sum,
      ungroup(tree_data_plot_summary) %>% 
            select(plot_id:avg_char_ht, pct_pinus_dbh,
                   tree_richness = richness)
            )
# summary(tick_data_sum)
## NAs for total dbh/richness at shelby b3 because no alive/standing trees in this invaded plot

tick_data_sum <- left_join(
      tick_data_sum,
      ungroup(subplot_plot_summary) %>% 
            select(plot_id:total_stems_100m2)
)
summary(tick_data_sum)
# filter(tick_data_sum, is.na(shrub_sap_rich))$plot_id
## presumably these four plots had no understory to record during one visit?
# filter(tick_data_sum, is.na(avg_tree_ht))$plot_id
## likely did not record tree height at those visits

tick_data_sum <- tick_data_sum %>% 
      mutate(total_stems_100m2 = case_when(
            plot_id == "blanding g1" ~ 0,
            plot_id == "blanding h1" ~ 0,
            plot_id == "tyndall b1" ~ 0,
            plot_id == "blanding c1" ~ 0,
            TRUE ~ total_stems_100m2
      ),
      shrub_sap_rich = case_when(
            plot_id == "blanding g1" ~ 0,
            plot_id == "blanding h1" ~ 0,
            plot_id == "tyndall b1" ~ 0,
            plot_id == "blanding c1" ~ 0,
            TRUE ~ total_stems_100m2
      ))

filter(biomass_plot_summary, plot_id=="shelby b1")$avg_dry_standing_gm2

summary(tick_data_sum)
filter(tick_data_sum, is.na(avg_dry_standing_gm2))$plot_id
## Missing Shelby B1 2017 b/c it was cogongrass, so we didn't bring back
str(tick_data_sum)
# unique(tick_data_sum$imcy_inv)


write_csv(tick_data_sum, "data/all_plotlevel_data.csv")

# filter(tick_data_sum, is.na(avg_pct_litter))$plot_id

# unique(tick_data_sum$inst_name)
# unique(tree_data_summary$inst_name)


# tick_data_sum$imcy_inv <- factor(tick_data_sum$imcy_inv, levels = c("Uninvaded","Invaded"), labels = c("Uninvaded","Invaded"))

# skimr::skim(tick_data_sum)
```

```{r load all plot level data, results='hide'}

tick_data_sum <- read_csv("data/processed_data/all_plotlevel_data.csv")
# summary(tick_data_sum)
climate_data <- read_csv("data/processed_data/aggregated_plot_daymet_data.csv")
tick_data_sum <- left_join(tick_data_sum, climate_data)

tick_data_sum$imcy_inv <- factor(tick_data_sum$imcy_inv, levels = c("Uninvaded","Invaded"))

```


## Total ticks collected 

The high tick abundance for 8-years post-fire is driven by a single plot at Camp Blanding.

```{r tick life stage abundance fire}

tick_data %>% 
      filter(!is.na(imcy_inv), !is.na(life_stage), life_stage!="Larval") %>% 
ggplot(aes(log(y_since_fire), log1p(tick_count), color = imcy_inv, fill = imcy_inv)) +
      # geom_bar(stat = "identity", position = "dodge", show.legend = F) +
      # geom_violin(aes(fill = imcy_inv), alpha = .3) +
      geom_point(aes(shape = life_stage),alpha = 1, position = "jitter", size = 2) +
      # stat_summary(fun.data = "mean_se", geom = "pointrange") +
      invasion_color +
      invasion_fill +
      scale_shape_manual(values = c(2,15)) +
      # scale_x_continuous(breaks = c(seq(0,11,1))) +
      # geom_dotplot(aes(fill = imcy_inv),
      #            binaxis = "y",         # which axis to bin along
      #            binwidth = .2,       # Minimal difference considered different
      #            stackdir = "center"    # Centered
      #            ) +
      # facet_grid(life_stage~.) +
      xlab("Years since fire") +
      ylab("log( tick abundance )") +
      # theme_classic() +
      theme_bw() +
      def_theme +
      # theme(legend.position = c(.88,.88)) +
      NULL

# ggplot(tick_data, aes(as.factor(years_since_fire), count)) +
#       stat_summary(fun.data = "mean_se",geom = "pointrange") +
#       xlab("Years since fire") +
#       ylab("Tick abundance") +
#       theme_classic() +
#       def_theme

# ggsave("~/Dropbox (UF)/SERDP-Project/figures/tick-life-stage-vs-fire.png", height=7.5, width = 7.5)

```


```{r tick abundance by installation fig}

ggplot(tick_data_sum, aes(inst_name, total_ticks, fill = inst_name)) +
      # geom_boxplot()
      geom_col() +
      scale_fill_viridis_d() +
      facet_grid(visit_year~.) +
      theme_bw() +
      ylab("Tick abundance") +
      def_theme +
      theme(legend.title = element_blank(),
            legend.position = "right") +
      NULL

# ggsave("~/Dropbox (UF)/SERDP-Project/figures/tick-species-installation.png", height=7.5, width = 7.5)

```

## Seasonal sampling

```{r tick-abundance-by-date}

tick_data$week <- lubridate::week((tick_data$visit_date))

             
ggplot(filter(tick_data, !is.na(life_stage)),
       aes(visit_date, tick_count)) +
      # geom_line(aes(linetype = life_stage)) +
      geom_point(aes(color = life_stage), size = 2, alpha = .7) +
      # stat_summary(fun.data = "mean_se", geom = "pointrange") +
      # geom_bar(aes(fill = inst_name), stat = "identity") +
      facet_grid(.~visit_year, scales = "free_x") +
      # scale_x_date(limits = c(as.Date("2017-06-06"),as.Date("2018-08-01")),
                   # date_breaks = "3 month") +
      # geom_smooth(alpha = .2) +
      scale_color_viridis_d() +
      theme_classic() +
      ylab("Tick abundance") +
      xlab("") +
      def_theme +
      theme(legend.position = c(.5,.85),
            legend.background = element_rect(color="black"))

# ggsave("~/Dropbox (UF)/SERDP-Project/figures/ticks-by-week.png", height=7.5, width = 7.5)
      
```

## Tick abundance vs. latitude

No relationship, which is expected, though our range of latitude is very small. I plan to use an actual climate variable in the model, e.g. PRISM 30-year normals, WorldClim, DayMet, or possibly data from local weather stations.

```{r tick-abundance-latitude, eval=T}

ggplot(filter(tick_data_sum, !is.na(imcy_inv)), 
       aes(lat, log1p(total_ticks))) +
      geom_point(aes(color = inst_name), position = "jitter") +
      # invasion_color +
      invasion_fill + 
      # geom_smooth(aes(fill = imcy_inv), se = F, alpha = .2, method = "lm") +
      geom_smooth(aes(), method = "loess", linetype = "dashed", se = F, alpha = .2) +
      facet_grid(imcy_inv~.) +
      scale_color_viridis_d() +
      # theme_classic() +
      theme_bw() +
      xlab("Latitude") +
      ylab("log( tick abundance + 1 )") +
      def_theme +
      theme(legend.position = "right") +
      NULL

# ggsave("~/Dropbox (UF)/SERDP-Project/figures/ticks-by-latitude.png", height=7.5, width = 7.5)

ggplot(filter(tick_data_sum, !is.na(imcy_inv)), 
       aes(lon, log1p(total_ticks))) +
      geom_point(aes(color = inst_name), position = "jitter") +
      # invasion_color +
      invasion_fill + 
      # geom_smooth(aes(fill = imcy_inv), se = F, alpha = .2, method = "lm") +
      # geom_smooth(aes(), method = "loess", linetype = "dashed", se = F, alpha = .2) +
      facet_grid(imcy_inv~.) +
      scale_color_viridis_d() +
      # theme_classic() +
      theme_bw() +
      xlab("Longitude") +
      ylab("log( tick abundance + 1 )") +
      def_theme +
      theme(legend.position = "right") +
      NULL

```

## Tick abundance ~ Climate Variables

```{r subset to climate vars data frame}

ticks_climate_15yr <- tick_data_sum %>% 
      select(plot_id:visit_date, inst_name, total_ticks, starts_with("avg_15yr"), starts_with("cv_15yr"), frindex) %>% 
      pivot_longer(., avg_15yr_srad..W.m.2.:cv_15yr)

ggplot(ticks_climate_15yr, aes(value, (frindex))) +
      geom_point(aes(color = inst_name)) +
      geom_smooth() +
      scale_color_viridis_d() +
      # invasion_color +
      facet_wrap(~ name, scales = "free_x") +
      theme_bw()

ticks_climate_30yr <- tick_data_sum %>% 
      select(plot_id:visit_date, inst_name, total_ticks, starts_with("avg_30yr"), starts_with("cv_30yr"), frindex) %>% 
      pivot_longer(., avg_30yr_srad..W.m.2.:cv_30yr_prcp..mm.day.)

ggplot(ticks_climate_30yr, aes(value, log1p(total_ticks))) +
      geom_point(aes(color = inst_name)) +
      geom_smooth() +
      scale_color_viridis_d() +
      # invasion_color +
      facet_wrap(~ name, scales = "free_x") +
      theme_bw()


```


## Tick~fire log-linear relationship 

```{r tick-fire}

# unique(tick_data_plot_summary$inst_name)
# filter(tick_data_plot_summary, is.na(inst_name))$plot_id

(tick_fire_fig <- ggplot(filter(tick_data_sum,), 
       aes(y_since_fire, log1p(total_ticks), fill = imcy_inv, color = imcy_inv)) +
      # geom_smooth(aes(fill = imcy_inv), se = F, method = "loess", linetype = "dashed", alpha = .2) +
      geom_smooth(se = T, method = "lm", alpha = .2) +
      geom_smooth(se = F, method = "loess", linetype = 2, alpha = .2) +
      geom_point(position = "jitter") +
      invasion_color +
      invasion_fill +
      # geom_smooth(aes(color = imcy_inv), method = "loess",
                  # linetype = "dashed", se = F, alpha = .2) +
      # scale_shape_manual(values = c(inst_name=2, 19, 19, 19, 19, 19, 19, 19, 19)) +
      theme_classic() +
      xlab("Years since fire") +
      ylab("log( tick abundance + 1 )") +
      def_theme +
       theme(legend.position = "right") +
      NULL)

# ggsave("~/Dropbox (UF)/SERDP-Project/figures/ticks-vs-fire.png", height = 7.5, width = 7.5)

ggplot(tick_data_sum, 
       aes((fri15yr), log1p(total_ticks), fill = imcy_inv, color = imcy_inv)) +
      geom_smooth(se = T, method = "lm", alpha = .2) +
      geom_point(position = "jitter") +
      invasion_color +
      invasion_fill +
      # scale_shape_manual(values = c(inst_name=2, 19, 19, 19, 19, 19, 19, 19, 19)) +
      theme_classic() +
      xlab("15-year fire return interval (years)") +
      ylab("log( tick abundance + 1 )") +
      def_theme +
      NULL

ggplot(tick_data_sum, 
       aes(log(frindex), log1p(total_ticks), fill = imcy_inv, color = imcy_inv)) +
      geom_smooth(se = T, method = "lm", alpha = .2) +
      geom_point(position = "jitter") +
      invasion_color +
      invasion_fill +
      # scale_shape_manual(values = c(inst_name=2, 19, 19, 19, 19, 19, 19, 19, 19)) +
      theme_classic() +
      xlab("15-year fire return index (log)") +
      ylab("log( tick abundance + 1 )") +
      def_theme +
      NULL

```

```{r model tick abundance vs fire}

tick_fire_model1 <- lm(log1p(total_ticks) ~ y_since_fire + imcy_inv, data = tick_data_sum)
summary(tick_fire_model1)
tick_fire_model1a <- lm(log1p(total_ticks) ~ log(y_since_fire) + imcy_inv, data = tick_data_sum)
summary(tick_fire_model1a)

tick_fire_model1b <- glm(total_ticks ~ y_since_fire + imcy_inv, data = tick_data_sum, family = poisson)
summary(tick_fire_model1b)

tick_fire_model1c <- MASS::glm.nb(total_ticks ~ y_since_fire + imcy_inv, data = tick_data_sum)
summary(tick_fire_model1c)

tick_fire_model2 <- MASS::glm.nb(total_ticks ~ fri15yr + imcy_inv, data = tick_data_sum)
summary(tick_fire_model2)

tick_fire_model3 <- MASS::glm.nb(total_ticks ~ log(frindex) + imcy_inv, data = tick_data_sum)
summary(tick_fire_model3)

```

Tick abundances may also be influenced by some of the other land uses that happen on DoD installations, such as cattle grazing, hunting, and most obviously training. Grazers may treat their cattle to reduce ectoparasite (e.g. ticks) loads and the pathogens they transmit. These treatments are often effective in deterring parasite attachment, killing parasites through contact, and can lower the production and viability of parasite eggs. For example, Avon Park AFR leases some areas for cattle grazing and we confirmed that some grazers used treatments that will reduce tick loads (e.g., moxidectin, Cydectin, Aguilar-Tipacamu & Rodriguez-Vivas 2003). 


# Tick abundance vs. plot-level averages

## Understory vegetation cover

```{r tick-veg-cover}

ggplot(tick_data_sum, 
       aes(plot_avg_veg_cover, log1p(total_ticks), color = imcy_inv)) +
      geom_point() +
      invasion_color +
      invasion_fill +
      geom_smooth(aes(fill = imcy_inv), se = T, alpha = .2, method = "lm", show.legend = F) +
      # geom_smooth(aes(fill = imcy_inv), method = "loess", linetype = "dashed", se = F, alpha = .2, show.legend = F) +
      # facet_grid(imcy_inv~.) +
      theme_classic() +
      # theme_bw() +
      xlab("Vegetation cover (%)") +
      ylab("log( tick abundance + 1 )") +
      def_theme +
      # theme(legend.position = c(.85,.85)) +
      NULL

# ggsave("~/Dropbox (UF)/SERDP-Project/figures/ticks-by-veg-cover.png", height=7.5, width = 7.5)

```


## Understory biomass 
Log-linear relationship, very noisy trends with many zeroes. Plots associated with invasions had either zero or one ticks.

```{r tick-veg-biomass}

(tick_veg_mass_fig <- ggplot(filter(tick_data_sum, !is.na(imcy_inv)), 
       aes(avg_dry_standing_gm2, log1p(total_ticks), color = imcy_inv)) +
      geom_point() +
      invasion_color +
      invasion_fill +
      geom_smooth(aes(fill = imcy_inv), se = T, alpha = .2, method = "lm", show.legend = F) +
      # geom_smooth(aes(fill = imcy_inv), se = F, alpha = .2, method = "loess", show.legend = F, linetype = "dashed") +
      theme_classic() +
      xlab(expression(paste("Average standing biomass (g ", m^{-2}, ")"))) +
      ylab("log( tick abundance + 1 )") +
      ggtitle("Understory standing biomass") +
      def_theme +
      # theme(legend.position = c(.85,.85)) +
      NULL
)

# ggsave("~/Dropbox (UF)/SERDP-Project/figures/ticks-by-standing-biomass.png", height=7.5, width = 7.5)
# summary(glm(total_ticks ~ avg_standing_gm2, data = tick_data_sum, family = "quasipoisson"))

```

```{r ticks standing biomass model}

tick_veg_mass_model <- lm(log1p(total_ticks) ~ avg_dry_standing_gm2 + imcy_inv, data = tick_data_sum)
summary(tick_veg_mass_model)

```



## Litter percent cover
```{r tick-litter-cover}

(tick_pctlitter_fig <- ggplot(filter(tick_data_sum, !is.na(imcy_inv)), 
       aes(avg_pct_litter, log1p(total_ticks), color = imcy_inv)) +
      geom_point() +
      invasion_color +
      invasion_fill +
      geom_smooth(aes(fill = imcy_inv), se = T, alpha = .2, method = "lm", show.legend = T) +
       # geom_smooth(aes(fill = imcy_inv), se = F, alpha = .2, method = "loess", show.legend = T, linetype = "dashed") +
      theme_classic() +
      xlab(expression(paste("Litter cover (%)"))) +
      ylab("log( tick abundance + 1 )") +
      def_theme +
      # theme(legend.position = c(.2,.85)) +
      NULL
)
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/ticks-by-litter-cover1.png", height=7.5, width = 7.5)

### take out invasion factor
(tick_pctlitter_fig2 <- ggplot(filter(tick_data_sum, !is.na(imcy_inv)), 
       aes(avg_pct_litter, log1p(total_ticks))) +
      geom_point(aes(),alpha = .8) +
      # invasion_color +
      # invasion_fill +
      geom_smooth(se = T, alpha = .2, method = "loess", show.legend = F, linetype = "dashed") +
      theme_classic() +
      xlab(expression(paste("Litter cover (%)"))) +
      ylab("log( tick abundance + 1 )") +
      def_theme +
      NULL
)
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/ticks-by-litter-cover2.png", height=7.5, width = 7.5)

```


## Litter biomass

Tick abundance plotted against dried litter biomass in invaded and uninvaded plots. 

```{r tick-litter-mass}

(tick_litter_mass_fig <- ggplot(
      filter(tick_data_sum, !is.na(imcy_inv)), 
       aes(avg_dry_litter_gm2, log1p(total_ticks), color = imcy_inv)) +
      geom_point() +
      invasion_color +
      invasion_fill +
      geom_smooth(aes(fill = imcy_inv), se = T, alpha = .2, method = "lm", show.legend = F) +
      # geom_smooth(aes(), se = F, alpha = .2, method = "loess", show.legend = F, linetype = "dashed") +
      # facet_grid(imcy_inv~.) +
      theme_classic() +
      # theme_bw() +
      xlab(expression(paste("Litter biomass (g ", m^{-2}, ")"))) +
      ylab("log( tick abundance + 1 )") +
      # ggtitle("Litter biomass") +
      def_theme
      # theme(legend.position = c(.15,.9))
)
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/ticks-by-litter-mass.png", height=7.5, width=7.5)

```

## Litter moisture
```{r tick-litter-moisture}

(tick_litter_moisture_fig <- ggplot(
      filter(tick_data_sum, !is.na(imcy_inv)), 
       aes(avg_pct_litter_moisture, log1p(total_ticks), color = imcy_inv)) +
      geom_point(aes()) +
      invasion_color +
      invasion_fill +
      geom_smooth(aes(fill = imcy_inv), se = T, alpha = .2, method = "lm", show.legend = F) +
      # geom_smooth(aes(), se = F, alpha = .2, method = "loess", show.legend = F, linetype = "dashed") +
      # facet_grid(imcy_inv~.) +
      theme_classic() +
      # theme_bw() +
      xlab(expression(paste("Litter moisture (%)"))) +
      ylab("log( tick abundance + 1 )") +
      def_theme +
      # theme(legend.position = c(.15,.9)) +
      # ggtitle("Litter moisture") +
      NULL
)
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/ticks-by-litter-mass.png", height = 7.5, width = 7.5)

```

```{r ticks litter model}
# pairs plot ####
# GGally::ggpairs(
#       tick_data_sum %>% 
#             filter(!is.na(imcy_inv)) %>% 
#             mutate(ln_ticks = log1p(total_ticks)) %>% 
#             select(ln_ticks, avg_dry_litter_gm2, avg_pct_litter, avg_pct_litter_moisture, avg_litter_depth_all))

# linear models ####
ticks_litter_mass_mod <- lm(log1p(total_ticks) ~ avg_dry_litter_gm2 + avg_pct_litter_moisture, data = tick_data_sum)
summary(ticks_litter_mass_mod)

ticks_litter_cover_mod <- lm(log1p(total_ticks) ~ avg_pct_litter + avg_pct_litter_moisture, data = tick_data_sum)
summary(ticks_litter_cover_mod)

AIC(ticks_litter_mass_mod, ticks_litter_cover_mod)

# model plots ####
### require(sjPlot) in user's package library
# sjPlot::plot_model(ticks_litter_cover_mod, show.values = T, type = "diag")
# sjPlot::plot_model(ticks_litter_cover_mod, show.values = T, type = "std")
# sjPlot::plot_model(ticks_litter_cover_mod, show.values = T, type = "pred", terms = c("avg_pct_litter", "avg_pct_litter_moisture"))

```


## Canopy cover
Log-linear relationship, where there are more ticks in plots with more canopy cover.

```{r tick-canopy-cover}

(tick_canopy_cover_fig <- ggplot(
      filter(tick_data_sum, !is.na(imcy_inv)), 
       aes(avg_canopy_cover, log1p(total_ticks), color = imcy_inv)) +
      geom_point() +
      invasion_color +
      invasion_fill +
      geom_smooth(aes(fill = imcy_inv), se = T, alpha = .2, method = "lm") +
      # geom_smooth(aes(), se = F, alpha = .2, method = "loess", linetype = "dashed", show.legend = F) +
      # facet_grid(imcy_inv~.) +
      theme_classic() +
      # theme_bw() +
      xlab(expression(paste("Canopy cover (%)"))) +
      ylab("log( tick abundance + 1 )") +
      def_theme +
      # theme(legend.position = c(.15,.9)) +
      NULL
)
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/ticks-by-canopy-cover.png", height=7.5, width = 7.5)

```

```{r ticks canopy cover model}
# pairs plot ####
# GGally::ggpairs(
#       tick_data_sum %>% 
#             filter(!is.na(imcy_inv)) %>% 
#             mutate(ln_ticks = log1p(total_ticks)) %>% 
#             select(ln_ticks, avg_dry_litter_gm2, avg_pct_litter, avg_pct_litter_moisture, avg_canopy_cover))

# linear model ####
tick_canopy_mod <- lm(log1p(total_ticks) ~ avg_canopy_cover, data = tick_data_sum)
summary(tick_canopy_mod)

tick_canopy_mod2 <- lm(log1p(total_ticks) ~ avg_canopy_cover + avg_pct_litter + avg_pct_litter_moisture, data = tick_data_sum)
summary(tick_canopy_mod2)

tick_canopy_mod3 <- lm(log1p(total_ticks) ~ avg_canopy_cover + avg_dry_litter_gm2 + avg_pct_litter_moisture, data = tick_data_sum)
summary(tick_canopy_mod3)

mod.glm1 <- glm(total_ticks ~ avg_canopy_cover + avg_pct_litter + avg_pct_litter_moisture, data = tick_data_sum, family = "quasipoisson")
summary(mod.glm1)

mod.glm2 <- glm(total_ticks ~ avg_canopy_cover + avg_dry_litter_gm2 + avg_pct_litter_moisture, data = tick_data_sum, family="quasipoisson")
summary(mod.glm2)

mod.glm.nb <- MASS::glm.nb(total_ticks ~ avg_canopy_cover + avg_pct_litter + avg_pct_litter_moisture, data = tick_data_sum)
summary(mod.glm.nb)


# model plots ####
### require(sjPlot) in user's package library
# sjPlot::plot_model(tick_canopy_mod2, show.values = T, type = "diag")
# sjPlot::plot_model(tick_canopy_mod2, type = "resid")
# sjPlot::plot_model(tick_canopy_mod2, show.values = T, type = "std")
# sjPlot::plot_model(tick_canopy_mod2, show.values = T, type = "slope")
# sjPlot::plot_model(tick_canopy_mod2, show.values = T, type = "pred", terms = c("avg_pct_litter", "avg_pct_litter_moisture", "avg_canopy_cover"))

```

## Ticks ~ pine dominance
Perhaps most useful for specific installations because that would minmize overlap of the points. Interesting that overall there may be a threshold around 60% pine dominance where tick abundance starts to decline dramatically, but that could also be an artifact of most of the plots having greater than 60% pine and tick abundances were generally low. For example, there doesn't seem to be more really high tick abundances in less pine dominated than more pine dominated plots (>3 on the log scale).

```{r ticks-pine}

ggplot(tick_data_sum, aes(pct_pinus_dbh, log1p(total_ticks))) +
      geom_point(aes(color = y_since_fire), size = 2, position = "jitter") +
      geom_smooth() +
      scale_color_viridis_c() +
      theme_classic()

```


## Ticks ~ char height

```{r tick char ht figure}

(tick_char_fig <- ggplot(filter(tick_data_sum, !is.na(imcy_inv)), 
       aes(avg_char_ht, log1p(total_ticks), color = imcy_inv)) +
      geom_point(aes(), alpha = .5) +
      invasion_color +
      invasion_fill +
      geom_smooth(aes(fill = imcy_inv), se = T, alpha = .2, method = "lm") +
      # geom_smooth(se = F, alpha = .2, method = "loess", linetype = "dashed", show.legend = F) +
       # facet_grid(imcy_inv~.) +
      # geom_smooth(method = "lm", color = "gray50", se = F) +
      theme_classic() +
      # xlab(expression(paste("log( # of dung clusters + 1)"))) +
      # ylab("log( tick abundance + 1 )") +
      def_theme +
      # theme(legend.position = c(.85,.9)) +
      NULL
)
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/tick-char.png", height = 7.5, width = 7.5)

```


## Ticks ~ hosts
Log-log relationship between tick density and host density

```{r tick-hosts}

(tick_host_fig1 <- ggplot(
      filter(tick_data_sum, !is.na(imcy_inv)), 
       aes(log1p(total_clusters1m), log1p(total_ticks), color = imcy_inv)) +
      geom_point() +
      invasion_color +
      invasion_fill +
      geom_smooth(aes(fill = imcy_inv), se = T, alpha = .2, method = "lm") +
      # geom_smooth(aes(fill = imcy_inv), se = F, alpha = .2, method = "loess", linetype = "dashed", show.legend = F) +
      # geom_smooth(method = "lm", color = "black", se = F) +
      theme_classic() +
      xlab(expression(paste("log( # of dung clusters + 1)"))) +
      ylab("log( tick abundance + 1 )") +
      def_theme +
      # theme(legend.position = c(.85,.9)) +
      NULL
)
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/ticks-by-host1.png", height=7.5, width = 7.5)

# (tick_host_fig2 <- ggplot(
#       filter(tick_data_sum, !is.na(imcy_inv), !is.na(life_stage)), 
#        aes(log1p(avg_clusters1m), log1p(total_ticks))) +
#       geom_point(aes(color = imcy_inv), alpha = .5) +
#       # invasion_color +
#       invasion_fill +
#       geom_smooth(aes(), se = T, alpha = .2, method = "lm") +
#       geom_smooth(aes(), se = F, alpha = .2, method = "loess", linetype = "dashed", show.legend = F) +
#       facet_grid(imcy_inv~.) +
#       # geom_smooth(method = "lm", color = "gray50", se = F) +
#       # theme_classic() +
#       theme_bw() +
#       xlab(expression(paste("log( # of dung clusters + 1)"))) +
#       ylab("log( tick abundance + 1 )") +
#       def_theme
# )
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/ticks-by-host1.png", height=7)

```

Loess lines are dashed, lines from the linear model are solid, and the black solid line is the overall trend when pooling the data across invaded and uninvaded plots.

```{r tick host model}
# pairs plot ####
# GGally::ggpairs(
#       tick_data_sum %>% 
#             filter(!is.na(imcy_inv)) %>% 
#             mutate(ln_ticks = log1p(total_ticks)) %>% 
#             select(ln_ticks, total_clusters1m, avg_dry_litter_gm2, avg_pct_litter, avg_pct_litter_moisture, avg_canopy_cover, years_since_fire, total_ticks))

# linear model ####
tick_host_model <- lm(log1p(total_ticks) ~ total_clusters1m, data = tick_data_sum)
summary(tick_host_model)

```

There isn't any relationship. During discussion at the PI meeting in August 2018 Brian suggested that it's possible that the hosts are more homogeneously distributed across the landscape because it is generally similar. In contrast, the ticks may be responding to smaller scale heterogeneity. 

# Host abundance
Host abundance tended to be slightly lower with increasing canopy cover and time since fire. The trend isn't significant

```{r hosts-canopy-cover}

 ggplot(filter(tick_data_sum, !is.na(imcy_inv)), 
        aes(avg_canopy_cover, log1p(total_clusters1m))) +
      geom_point(aes(color = imcy_inv)) +
      invasion_color +
      invasion_fill +
      # geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "loess", se = F, alpha = .2, linetype = "dashed") +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "lm", se = T, alpha = .2) +
      theme_classic() +
      xlab(expression(paste("Canopy cover (%)"))) +
      ylab("log( dung clusters + 1 )") +
      def_theme
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/hosts-canopy-cover.png", height=7.5, width = 7.5)

```

```{r host canopy cover model}

host_canopy_model <- lm(log1p(total_clusters1m) ~ avg_canopy_cover, data = tick_data_sum)
summary(host_canopy_model)

```


```{r host-fire}

ggplot(filter(tick_data_sum, !is.na(imcy_inv)), 
        aes((y_since_fire), log1p(total_clusters1m))) +
      geom_point(aes(color = imcy_inv), alpha = .5) +
      invasion_color +
      invasion_fill +
      # geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "loess", se = F, alpha = .2, linetype = "dashed") +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "lm", se = T, alpha = .2) +
      theme_classic() +
      xlab(expression(paste("Years since fire"))) +
      ylab("log( dung clusters + 1 )") +
      def_theme
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/hosts-fire.png", height = 7.5, width = 7.5)

ggplot(filter(tick_data_sum, !is.na(imcy_inv)), 
        aes(log(fri15yr), log1p(total_clusters1m))) +
      geom_point(aes(color = imcy_inv), alpha = .5) +
      invasion_color +
      invasion_fill +
      # geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "loess", se = F, alpha = .2, linetype = "dashed") +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "lm", se = T, alpha = .2) +
      theme_classic() +
      xlab("15-year fire return interval (log)") +
      ylab("log( dung clusters + 1 )") +
      def_theme

ggplot(filter(tick_data_sum, !is.na(imcy_inv)), 
        aes(log(frindex), log1p(total_clusters1m))) +
      geom_point(aes(color = imcy_inv), alpha = .5) +
      invasion_color +
      invasion_fill +
      # geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "loess", se = F, alpha = .2, linetype = "dashed") +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "lm", se = T, alpha = .2) +
      theme_classic() +
      xlab("15-year fire return index (log)") +
      ylab("log( dung clusters + 1 )") +
      def_theme

```

```{r host fire model}

host_fire_mod <- lm(log1p(total_clusters1m) ~ log(y_since_fire), data = tick_data_sum)
summary(host_fire_mod)

```

```{r host-trees, eval=F}

ggplot(filter(tick_data_sum, !is.na(imcy_inv)), 
       aes(total_dbh, log1p(total_clusters1m))) +
      geom_point(aes(color = imcy_inv)) +
      invasion_color +
      geom_smooth(aes(color = imcy_inv), method = "lm", se = F, alpha = .2) +
      theme_classic() +
      xlab(expression(paste("Total DBH (cm)"))) +
      ylab("log( # of dung clusters + 1 ) ") +
      def_theme
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/hosts-tree-dbh.png", height=7.5, width = 7.5)

```

```{r host trees model}

host_trees_mod <- lm(log1p(total_clusters1m) ~ total_dbh, data = tick_data_sum)
summary(host_trees_mod)

```

A question asked at the August 2018 PI meeting was whether there was an effect of installation for host data. 

**This still needs to be addressed** 

# Initial/exploratory models
```{r linear models ticks, eval=F}

GGally::ggpairs(select(tick_data_sum, y_since_fire, avg_pct_litter, avg_pct_litter_moisture, avg_canopy_cover, pct_pinus_dbh, avg_30yr_vp..Pa., avg_30yr_tmax..deg.c., avg_30yr_tmin..deg.c., avg_30yr_prcp..mm.day.))

m1 <- lm(log1p(total_ticks) ~ avg_pct_litter + avg_pct_litter_moisture + pct_pinus_dbh, data = tick_data_sum)
summary(m1)
sjPlot::plot_model(m1, type = "diag")
sjPlot::plot_model(m1, type = "std", show.values = T)

m2 <- glm(total_ticks ~ avg_pct_litter + avg_pct_litter_moisture + pct_pinus_dbh, data = tick_data_sum, family = "quasipoisson")
summary(m2)
plot(m2)
sjPlot::plot_model(m2, type = "resid")
sjPlot::plot_model(m2, type = "std", show.values = T)
sjPlot::plot_model(m2, type = "resid")

m3 <- lm(log1p(total_ticks) ~ avg_dry_litter_gm2 + avg_pct_litter_moisture + pct_pinus_dbh, data = tick_data_sum)
summary(m3)


# summary(lm(log1p(total_ticks) ~ avg_dry_litter_gm2, data = tick_data_sum))
summary(lm(log1p(total_ticks) ~ avg_pct_litter, data = tick_data_sum))
summary(lm(log1p(total_ticks) ~ avg_canopy_cover, data = tick_data_sum))
summary(lm(log1p(total_ticks) ~ avg_pct_litter_moisture, data = tick_data_sum))

summary(lm(avg_dry_litter_gm2 ~ y_since_fire, data = tick_data_sum))
summary(lm(avg_canopy_cover ~ y_since_fire, data = tick_data_sum))
# summary(lm(log1p(total_ticks) ~ log1p(avg_clusters1m), data = tick_data_sum))

## Figure out theoretical range of fire return index ####
x <- seq(1,15,.5)
y <- 1/x
y2 <- runif(length(x), min = .002, max = 15)
y3 <- y/y2
plot(log(y3),y2) # Produces log-linear pattern between index and time since fire
1/15

```

```{r model data ggpairs plot, eval=T, fig.width=14, fig.height=14}
# install.packages("GGally")
library(GGally)

# summary(tick_data_sum)
# extra_ticks <- filter(tick_data_sum, is.na(imcy_inv))$plot_id
# sort(unique(tick_data_sum$plot_id))


model_data <- tick_data_sum %>% 
      mutate(f_visit_year = as.factor(visit_year),
             clusters_1_2 = rowSums(cbind(total_clusters1m,total_clusters2m), na.rm = T),
             day_of_year = lubridate::yday(visit_date),
             litter_kg_m2 = avg_dry_litter_gm2/1000,
             avg_30yr_vp_Pa100 = avg_30yr_vp..Pa./100,
             avg_15yr_vp_Pa100 = avg_15yr_vp..Pa./100,
             avg_30yr_prcp_cm = avg_30yr_prcp..mm.day./100,
             avg_15yr_prcp_cm = avg_15yr_prcp..mm.day./100
             )
# summary(model_data)

tick_mod_inv_pairs <- ggpairs(select(
      model_data, 
      total_ticks, y_since_fire, day_of_year, avg_30yr_vp..Pa., avg_15yr_vp..Pa., avg_dry_litter_gm2, avg_pct_litter, avg_canopy_cover, total_clusters1m, total_dbh, pct_pinus_dbh, total_stems_100m2, imcy_inv), aes(color = imcy_inv),
       upper = list(
             continuous = function(data, mapping, ...) {
                   ggally_cor(data = data, mapping = mapping) + invasion_color},
             combo = function(data, mapping, ...) {
                   ggally_box_no_facet(data = data, mapping = mapping) + invasion_fill}),
    
      lower = list(
            continuous = function(data, mapping, ...) {
                  ggally_points(data = data, mapping = mapping, alpha = .5, ) + invasion_color},
            combo = function(data, mapping, ...) {
                  ggally_facethist(data = data, mapping = mapping) + invasion_fill}),
    
    diag = list(
          continuous = function(data, mapping, ...) {
                ggally_densityDiag(data = data, mapping = mapping, alpha = .5) + invasion_fill}
          # combo = function(data, mapping, ...) {
          #       ggally_barDiag(data = data, mapping = mapping) + invasion_fill}
          )
    ) +
      # invasion_color +
      # invasion_fill +
      theme_bw() +
      theme(panel.grid = element_blank())

# ggsave(plot = tick_mod_inv_pairs, "figures/pairs_plot_tick_mod.png", width = 18, height = 12)


tick_mod_pairs <- ggpairs(select(
      model_data, total_ticks, y_since_fire, day_of_year, avg_30yr_vp..Pa., avg_15yr_vp..Pa., avg_dry_litter_gm2, avg_canopy_cover, total_clusters1m, clusters_1_2, total_dbh, pct_pinus_dbh, total_stems_100m2, lat)) +
      theme_bw() +
      theme(panel.grid = element_blank())
# ggsave(plot = tick_mod_pairs, "figures/pairs_plot_tick_mod_bw.png", width = 18, height = 12)

```


```{r path model structure with mixed effects models, eval=F}
# devtools::install_github("jslefche/piecewiseSEM@devel")
library(piecewiseSEM)
library(lme4)
#glmmadmb

m1 <- glmer(total_ticks ~ scale(frindex) + scale(litter_kg_m2) +
                  scale(avg_canopy_cover) +(1|inst_name) + (1|plot_id), data = model_data, family = "poisson")
summary(m1)

m2 <- glmer.nb(total_ticks ~ scale(frindex) + scale(avg_pct_litter) +
                  scale(avg_canopy_cover) + (1|inst_name) + (1|plot_id), data = model_data)
summary(m2)

AIC(m1,m2)

# glmer.nb(total_ticks ~  (1|installation) + (1|plot_id), data = model_data)

## Model tick counts as Poisson, negative binomial, or other distribution?
tick_mod <- glmer(
      total_ticks ~ 
            scale(total_clusters1m) +
            scale(litter_kg_m2) + # AIC: 475.8
            scale(avg_pct_litter_moisture) +
            scale(avg_pct_litter) + # AIC: 461.6
            scale(avg_canopy_cover) +
            pct_pinus_dbh
            scale(cv_15yr) + # prcp
            scale(avg_15yr_prcp_cm) +
            scale(avg_15yr_tmax..deg.c.) + # no
            scale(cv_15yr_tmax..deg.c.) + # no, strong -r w/frindex
            scale(avg_15yr_tmin..deg.c.) + # maybe, AIC: 486.6
            scale(cv_15yr_tmin..deg.c.) +
            scale(avg_15yr_vp_Pa100) + # maybe, AIC: 487
            scale(cv_15yr_vp..Pa.) + # no
            scale(avg_30yr_vp_Pa100) + # yes, AIC: 486.2
            scale(cv_30yr_vp..Pa.) + # no, strong -r w/frindex
            scale(avg_30yr_tmax..deg.c.) + # no
            scale(cv_30yr_tmax..deg.c.) + # no, strong -r w/frindex
            scale(avg_30yr_tmin..deg.c.) + # maybe, AIC: 486.6
            scale(cv_30yr_tmin..deg.c.) + # AIC: 477.4 strong -r w/frindex
            scale(avg_30yr_prcp_cm) + # no, AIC: 482.6
            scale(cv_30yr_prcp..mm.day.) + # yes, AIC: 473.9
            scale(day_of_year) +
            scale(y_since_fire) + # no clim, AIC: 463.2
            scale(frindex) + # no clim, AIC: 480.9
            scale(fri15yr) + # no clim, AIC: 487.6
            f_visit_year + # no significant effect
            (1|inst_name) + (1|plot_id),
      data = model_data, family = "poisson", na.action = "na.fail")

dredge_tick_mod <- MuMIn::dredge(tick_mod, m.lim = c(3,8), 
                                 extra = "adjR^2")

model_data <- as.data.frame(model_data)

mod <- psem(
      tick_mod,
      
      
      host_mod <- glmer.nb(total_clusters1m ~
                              # total_stems_100m2 +
                              # day_of_year +
                              frindex +
                              avg_canopy_cover +
                              # avg_30yr_vp_Pa100 +
                              # avg_15yr_vp_Pa100 +
                              cv_30yr_prcp..mm.day. +
                              # f_visit_year +
                              (1|inst_name) + (1|plot_id),
                        data = model_data),
      
      litter_mod <- lmer(avg_pct_litter ~ 
                               # cv_30yr_prcp..mm.day. + 
                               # avg_30yr_vp_Pa100 +
                               # avg_15yr_vp_Pa100 +
                               avg_canopy_cover +
                               frindex +
                               (1|inst_name) + (1|plot_id), 
                         data = model_data),
      
      # div_mod <- lm(log1p(shrub_sap_rich) ~ 
      #                     # years_since_fire +
      #                     frindex,
      #                     # avg_canopy_cover,
      #               data = tick_data_sum),
      # 
      # bare_grnd_mod <- lmer(avg_pct_bare ~ years_since_fire + (1|years_since_fire) + (1|installation), data = tick_data_sum),
      
      # basal_area_mod <- lmer(avg_basal_area ~ years_since_fire + (1|years_since_fire) + (1|installation), data = model_data),
      
      canopy_mod <- lmer(avg_canopy_cover ~
                               # y_since_fire +
                               cv_30yr_prcp..mm.day. + 
                               # avg_30yr_vp_Pa100 +
                               # avg_yr_vp_Pa100 +
                               frindex +
                               (1|inst_name) + (1|plot_id),
                         data = model_data),
      
      
      fire_mod <- lmer(fri15yr ~ 
                             # avg_15yr_tmin..deg.c. + # no, AIC: 36.5
                             # avg_30yr_fire_days + # no, AIC: 39.5
                             # avg_15yr_fire_days + # no, AIC: 40.3
                             # avg_30yr_tmin..deg.c. + # no, AIC: 37.4
                             # avg_30yr_tmax..deg.c. + # no, AIC: 37.3
                             # avg_15yr_tmax..deg.c. + # no, AIC: 37.4
                             # avg_30yr_prcp_cm + # no, AIC: 37.7
                             # avg_15yr_srad..W.m.2. + # no, AIC: 39.5
                             # cv_30yr_tmin..deg.c. +
                             # cv_30yr_prcp..mm.day. + # no, AIC: 37.8
                             # cv_30yr_vp..Pa. + # no, AIC: 36.5
                             # cv_15yr_vp..Pa. + # no, AIC: 37.1
                             # cv_30yr_prcp..mm.day. +
                             cv_30yr_tmax..deg.c. + #no, AIC: 34.5
                             # avg_15yr_vp_Pa100 + # no, AIC: 37.1
                             (1|inst_name), model_data) # AIC: 30.2
      )

psem.model.summary <- summary(mod, conserve = TRUE)
psem.model.summary
# broom::tidy(psem.model.summary)

knitr::kable(psem.model.summary$coefficients, digits = 2)

ggplot(model_data, aes(installation, fri15yr)) +
      geom_boxplot()

```
```{r eval=FALSE}
library(dagitty)
g <- dagitty("dag{
             x1 -> y1
          x1 -> y3
y2 -> y3
y2 -> y1
y1 -> y3
             }")
plot(graphLayout(g))

impliedConditionalIndependencies(g)
```

```{r plot tick model, eval=F}

library(sjPlot)

plot_model(tick_mod, type = "diag")
plot_model(tick_mod.nb, type = "diag")

plot_model(tick_mod, type = "pred", terms = c("y_since_fire"), pred.type = "re", show.data = T)

plot_model(tick_mod, type = "pred", terms = c("avg_pct_litter"), pred.type = "re", show.data = T)

plot_model(tick_mod, type = "pred", terms = c("avg_canopy_cover"), pred.type = "re", show.data = T)

```



# Cogongrass Data Sampled from Invasions

```{r cogongrass data, eval=F}

cogon_data_raw <- read_csv("data/raw_data/cogon-data.csv")
summary(cogon_data_raw)

cogon_data_import <- read_csv("data/processed_data/cogongrass.csv")
summary(cogon_data_import)
filter(cogon_data_import, is.na(litter_wet))$plot_id

cogon_biomass <- cogon_data_import %>%
      select(site, plot_id, date, fresh_biomass, dry_biomass, litter_wet, litter_dry) %>%
      
      filter(!is.na(fresh_biomass)) %>%
      mutate(fresh_biomass_gm2 = fresh_biomass*16,
             dry_biomass_gm2 = dry_biomass*16,
             litter_wet_gm2 = litter_wet*16,
             litter_dry_gm2 = litter_dry*16,
             visit_date = lubridate::ymd(date))

d1 <- cogon_data_import %>% 
      mutate(avg_height = rowMeans(cbind(height1,height2,height3)),
             avg_width = rowMeans(cbind(width_1,width_2,width_3))) %>% 
      select(site:CogonSampleID,tiller_density,avg_height,avg_width) %>%
      mutate(est_leaf_area_cm = avg_height*avg_width*tiller_density,
             est_LAI = est_leaf_area_cm/10000)


cogon_ht <- cogon_data_import %>% 
      select(site:height3) %>% 
      # mutate(id = as.integer(seq(1,23,1))) %>% 
      gather(key = fid, value = height_cm, -site, -plot_id, -Quadrant, -CogonSampleID, -id) %>% 
      select(-fid,-id)

cogon_width <- cogon_data_import %>% 
      select(site:CogonSampleID,width_1:width_3) %>% 
      mutate(id = as.integer(seq(1,23,1))) %>% 
      gather(key = fid, value = width_cm, -site, -plot_id, -Quadrant, -CogonSampleID, -id) %>% 
      select(width_cm)

cogon_ht_width <- bind_cols(cogon_ht, cogon_width) %>% 
      mutate(est_leaf_area_cm = height_cm*width_cm)
summary(cogon_ht_width)

cogon_leaf_area <- left_join(
      select(cogon_data_import, site:CogonSampleID,tiller_density),
      cogon_ht_width %>%
      group_by(site,plot_id,Quadrant,CogonSampleID) %>% 
      summarise(avg_est_leaf_area_cm = mean(est_leaf_area_cm))
) %>% 
      mutate(total_est_leaf_area = tiller_density*avg_est_leaf_area_cm,
             est_LAI = total_est_leaf_area/10000)

skimr::skim(cogon_leaf_area)
skimr::skim(d1)


cogon_biomass <- left_join(
      cogon_biomass,
      select(plot_visit_data, visit_date, plot_id, y_since_fire, inst_name))
cogon_biomass$inst_name
summary(cogon_biomass)

cogon_data <- left_join(
      cogon_data_import %>% 
            mutate(visit_date = lubridate::ymd(date)),
      select(plot_visit_data, visit_date, plot_id, y_since_fire, inst_name))
summary(cogon_data)

ggplot(cogon_data, 
       aes(years_since_fire, tiller_density)) +
      geom_point(aes(color = inst_name), size = 2, position = "jitter") +
      scale_color_brewer(palette = "Dark2") +
      theme_classic() +
      xlab("Years since fire") +
      ylab(expression(paste("Tiller density (", m^{-2}, ")"))) +
      # ggtitle("Cogongrass biomass") +
      def_theme
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/cogon-biomass.png", height = 7)

```

To quantify cogongrass biomass, we collected samples of aboveground plant material in a 25cm x 25cm area. Up to three samples were collected in each invaded area in addition to sampling done as part of the larger plot. Maximum cogongrass biomass estimated from 25cm quadrat samples from invasions at DoD installations: `r #max(cogon_biomass$biomass)`g/m^2^

```{r invaded-vs-uninvaded-biomass, eval=F}

cogon_biomass_summary <- cogon_biomass %>% 
      group_by(plot_id, date) %>% 
      summarise(avg_fresh_cogon_gm2 = mean(fresh_biomass_gm2, na.rm = T),
                avg_dry_cogon_gm2 = mean(dry_biomass_gm2, na.rm = T))
summary(cogon_biomass_summary)
# biomass_data
# biomass_data_sub
# avg_biomass_data

biomass_plot_summary %>%
      select(plot_id, years_since_fire)
      mutate()

cogon_biomass_summary <- left_join(
      cogon_biomass_summary, 
      select(avg_biomass_data, installation:years_since_fire, avg_dry_standing_gm2, avg_standing_gm2 ),
      by = c("site"="installation","plot_id","years_since_fire")
)

library(tidyr)
biomass_comparison <- cogon_biomass_summary %>% 
      gather(biomass_type, biomass_weight, -site, -plot_id, -years_since_fire) %>% 
      mutate(biomass_type = if_else(biomass_type=="avg_fresh_cogon_gm2","Cogongrass (wet)",
                                    if_else(biomass_type=="avg_dry_cogon_gm2", "Cogongrass (dry)",
                                            if_else(biomass_type=="avg_standing_gm2", "Native (wet)", "Native (dry)")))) 
      # ungroup(.) %>% 
      # group_by(years_since_fire, biomass_type) %>% 
      # summarise(avg_biomass = mean(biomass_weight))
biomass_comparison$biomass_type <- factor(biomass_comparison$biomass_type, levels = c("Native (wet)", "Native (dry)", "Cogongrass (wet)","Cogongrass (dry)"))

ggplot(biomass_comparison, aes(years_since_fire, biomass_weight, color = biomass_type)) +
      geom_point() +
      geom_smooth(method = "loess", se = F) +
      # invasion_color +
      theme_classic() +
      def_theme +
      ylab(ylab(expression(paste("Fuel load (g/", m^{2}, ")")))) +
      xlab("Years since fire")

```

This is a quick and dirty estimate because there may be some overlap in the data. I need to clean up the calculation be separating out quadrats that have cogongrass in the plot data.

# Compare All Quadrat Data to Subset of Data

Percent cover

 * litter
 * bare ground
 * green

Heights

 * woody vegetation (3 measurements)
 * grassy/herbaceous vegetation (3 measurements)
 * litter (depth)
 
* If there was no vegetation or litter height to measure then the first vegetation measurement was assigned a value of zero and the other two `r NA`.


We (Drew and I) have been talking about the possibility of further reducing the amount of effort expended to sample vegetation and set up the plot by revising the plot design. 

**The alternative:** We use the 12.6m circular plot with just four vegetation sampling quadrats at 10 meters. Tick traps would be placed near the outside edge of the plot in each of the cardinal directions (north, east, south, west), and one in plot center.

**The caveats:** 1. Tick trap deployment and vegetation measurements would have to be on different days. 2. We still need to do transects for dung surveys.

My first step was to see how this plays out in the data by testing for differences in means of data summarized across all quadrats (12) to data from the quadrats at 10 meters (4). I subset the data and conducted a series of t-test on the means (averaging across all the 1 meter quadrats in each data set) of woody vegetation height, herbaceous vegetation height, litter depth; and percent covers of bare ground, green vegetation, and litter. 


```{r compare all 12 quadrats to subset of 4 at 10m, eval=F }
par(mfrow=c(1,2))
hist(log(quadrat_summaries$avg_woody_ht1))
hist(log(quadrat10m_summaries$avg_woody_ht1))
t.test(log(quadrat_summaries$avg_woody_ht1),log(quadrat10m_summaries$avg_woody_ht1), var.equal = F)

hist(log(quadrat_summaries$avg_woody_ht_all))
var(log(quadrat_summaries$avg_woody_ht_all))
hist(log(quadrat10m_summaries$avg_woody_ht_all))
var(log(quadrat10m_summaries$avg_woody_ht_all))
t.test(log(quadrat_summaries$avg_woody_ht_all),log(quadrat10m_summaries$avg_woody_ht_all), var.equal = F)

hist(log(quadrat_summaries$avg_herb_ht1))
var(log(quadrat_summaries$avg_herb_ht1))
hist(log(quadrat10m_summaries$avg_herb_ht1))
var(log(quadrat10m_summaries$avg_herb_ht1))
t.test(log(quadrat_summaries$avg_herb_ht1),
       log(quadrat10m_summaries$avg_herb_ht1), var.equal = F)

hist(log(quadrat_summaries$avg_herb_ht_all))
var(log(quadrat_summaries$avg_herb_ht_all))
hist(log(quadrat10m_summaries$avg_herb_ht_all))
var(log(quadrat10m_summaries$avg_herb_ht_all))
t.test(log(quadrat_summaries$avg_herb_ht_all),
       log(quadrat10m_summaries$avg_herb_ht_all), var.equal = F)

hist(log(quadrat_summaries$avg_litter_depth1))
var(log(quadrat_summaries$avg_litter_depth1))
hist(log(quadrat10m_summaries$avg_litter_depth1))
var(log(quadrat10m_summaries$avg_litter_depth1))
t.test(log(quadrat_summaries$avg_litter_depth1),
       log(quadrat10m_summaries$avg_litter_depth1), var.equal = F)

hist(log(quadrat_summaries$avg_litter_depth_all))
var(log(quadrat_summaries$avg_litter_depth_all))
hist(log(quadrat10m_summaries$avg_litter_depth_all))
var(log(quadrat10m_summaries$avg_litter_depth_all))
t.test(log(quadrat_summaries$avg_litter_depth_all),
       log(quadrat10m_summaries$avg_litter_depth_all), var.equal = T)

hist((quadrat_summaries$avg_pct_green))
var((quadrat_summaries$avg_pct_green))
hist((quadrat10m_summaries$avg_pct_green))
var((quadrat10m_summaries$avg_pct_green))
t.test((quadrat_summaries$avg_pct_green),
       (quadrat10m_summaries$avg_pct_green), var.equal = F)

hist(log(quadrat_summaries$avg_pct_litter))
var(log(quadrat_summaries$avg_pct_litter))
hist(log(quadrat10m_summaries$avg_pct_litter))
var(log(quadrat10m_summaries$avg_pct_litter))
t.test(log(quadrat_summaries$avg_pct_litter),
       log(quadrat10m_summaries$avg_pct_litter), var.equal = F)

hist(log1p(quadrat_summaries$avg_pct_bare))
var((quadrat_summaries$avg_pct_bare))
hist(log1p(quadrat10m_summaries$avg_pct_bare))
var((quadrat10m_summaries$avg_pct_bare))
t.test(log1p(quadrat_summaries$avg_pct_bare),
       log1p(quadrat10m_summaries$avg_pct_bare), var.equal = F)
```

Using all 12 qudrats we have `r #n_distinct(species_data$veg_id)` species, while using the four quadrats at 10 meters we have `r #n_distinct(species_sub$veg_id)` species. This suggests a major difference in species richness, however, some of these are as yet unidentified/grouped and are likely duplicates for both data sets. 

```{r t-test species cover quadrat subset, eval=F}
## Testing for differences in dense vs. less dense data collection
hist(log(species_data$pct_cover))
var(log(species_data$pct_cover))
hist(log(species_sub$pct_cover))
var(log(species_sub$pct_cover))
t.test(log(species_data$pct_cover), log(species_sub$pct_cover),
       var.equal = T, paired = F)
```
A t-test of the log-transformed means for percent cover indicate no statistical difference.

Based on these t-tests there were no statistical differences in the means of these variables aggregated to the plot level. 
